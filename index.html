<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EDM VERSEX | Live SoundCloud Top 50 and Latest Releases</title>

  <!-- Basic meta and mobile support -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <meta name="description"
        content="EDM VERSEX is an independent EDM hub with live SoundCloud based Top 50 charts, fresh global releases and editorial features for electronic dance music lovers.">
  <meta name="keywords"
        content="EDM, electronic dance music, house, trance, techno, SoundCloud, Top 50, latest releases, charts, DJ, producer, playlist, EDM VERSEX">
  <meta name="author" content="EDM VERSEX">
  <meta name="robots" content="index,follow">

  <!-- Canonical and Open Graph -->
  <link rel="canonical" href="https://www.edmversex.com/">

  <meta property="og:title" content="EDM VERSEX | Live SoundCloud Top 50 and Latest Releases">
  <meta property="og:description"
        content="EDM VERSEX brings together live charts, new releases and in depth features about house, trance and modern club sounds.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.edmversex.com/">
  <meta property="og:image" content="https://www.edmversex.com/assets/edmversex-cover.jpg">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="EDM VERSEX | Live SoundCloud Top 50 and Latest Releases">
  <meta name="twitter:description"
        content="Live EDM chart experience, latest SoundCloud releases and original editorial content.">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icon-180.png">

  <!-- Google AdSense -->
  <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4201977277980522"
          crossorigin="anonymous"></script>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1KFLYZ78XS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-1KFLYZ78XS");
  </script>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "edm-bg": "#020617",
            "edm-panel": "rgba(15,23,42,0.96)",
            "edm-glass": "rgba(15,23,42,0.80)",
            "edm-accent": "#22c55e",
            "edm-highlight": "#38bdf8"
          },
          boxShadow: {
            "edm-soft": "0 28px 80px rgba(15,23,42,0.92)"
          }
        }
      }
    };
  </script>

  <!-- Base styling -->
  <style>
    html, body {
      max-width: 100%;
      overflow-x: hidden;
      scroll-behavior: smooth;
      background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
    }

    :focus-visible {
      outline: 2px solid #22c55e;
      outline-offset: 3px;
    }

    #wave-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0.55;
      mix-blend-mode: screen;
    }
  </style>

  <!-- Structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "EDM VERSEX",
    "url": "https://www.edmversex.com/",
    "description": "EDM VERSEX is an electronic dance music hub with live charts, new releases and editorial stories.",
    "inLanguage": "en",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://www.edmversex.com/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
</head>

<body class="min-h-screen text-slate-50 antialiased bg-edm-bg relative">

<a href="#main"
   class="sr-only focus:not-sr-only focus:fixed focus:z-50 focus:top-3 focus:left-3 focus:px-4 focus:py-2 focus:rounded-full focus:bg-slate-900 focus:text-emerald-400">
  Skip to main content
</a>

<canvas id="wave-canvas"></canvas>

<!-- HEADER -->
<header class="sticky top-0 z-40 backdrop-blur-2xl bg-slate-950/90 border-b border-slate-800/80">
  <nav class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
    <a href="#top" class="flex items-center gap-2" aria-label="EDM VERSEX home">
      <span
        class="inline-flex h-9 w-9 rounded-full bg-gradient-to-tr from-emerald-500 via-sky-500 to-fuchsia-500 items-center justify-center shadow-lg shadow-emerald-500/40">
        <span class="h-3 w-3 rounded-full bg-slate-950"></span>
      </span>
      <span class="flex flex-col leading-tight">
        <span class="text-xs font-semibold tracking-[0.22em] uppercase text-emerald-400">EDM VERSEX</span>
        <span class="text-[11px] text-slate-300/90">Global EDM charts & stories</span>
      </span>
    </a>

    <nav class="ml-auto hidden md:flex items-center gap-2 text-[11px]">
      <a href="#top50" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Top 50</a>
      <a href="#latest" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Latest 20</a>
      <a href="#guides" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Guides</a>
      <a href="#about" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">About</a>
    </nav>
  </nav>

  <!-- Top banner: editorial intro + ad -->
  <section class="mx-auto max-w-6xl px-4 pb-3">
    <section class="rounded-2xl border border-slate-800 bg-slate-900/90 p-2 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
      <section class="text-[11px] text-slate-300 flex-1 pr-2">
        <p class="font-semibold text-slate-100">
          A home for modern club music.
        </p>
        <p class="mt-1">
          EDM VERSEX highlights forward-thinking house, trance and techno from around the world. 
          Discover new names, follow rising scenes and keep an eye on the tracks that actually move crowds.
        </p>
      </section>

      <section class="flex-1">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-4201977277980522"
             data-ad-slot="1234567890"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
          window.addEventListener("load", function () {
            try {
              (adsbygoogle = window.adsbygoogle || []).push({});
            } catch (e) {
              console.warn("AdSense top banner error", e);
            }
          });
        </script>
      </section>
    </section>
  </section>
</header>

<main id="main" class="mx-auto max-w-6xl px-4 pt-4 pb-28 space-y-6">

  <!-- HERO -->
  <section id="top"
           class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-6 lg:p-7 relative overflow-hidden">
    <section class="absolute inset-0 pointer-events-none opacity-40">
      <section class="absolute -top-10 -left-10 w-40 h-40 rounded-full bg-emerald-500 blur-3xl"></section>
      <section class="absolute -bottom-16 -right-16 w-56 h-56 rounded-full bg-sky-500 blur-3xl"></section>
    </section>

    <section class="relative flex flex-col lg:flex-row gap-6 lg:gap-10">
      <section class="flex-1 space-y-3">
        <p class="text-[11px] font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Electronic dance music homebase
        </p>
        <h1 class="text-xl sm:text-2xl lg:text-3xl font-semibold text-slate-50">
          Live global EDM charts, fresh SoundCloud discoveries and curated stories in one place.
        </h1>
        <p class="text-sm sm:text-[15px] text-slate-300/90">
          EDM VERSEX is a digital magazine for club culture. The front page combines live charts, 
          carefully selected new releases and written features that explore the ideas behind the music ‚Äì 
          from late-night warehouse anthems to early-morning melodic trips.
        </p>
        <p class="text-sm sm:text-[15px] text-slate-300/90">
          Every visit paints a slightly different picture of what is happening in house, trance and techno right now. 
          The charts shift as listeners press play, while the articles stay as a deeper reference for 
          DJs, producers and fans who want context, not just a tracklist.
        </p>

        <section class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3 text-[11px] sm:text-xs">
          <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
            <p class="text-slate-400 uppercase tracking-[0.2em]">Tracks in focus</p>
            <p class="mt-1 text-slate-50 font-semibold" id="stat-track-count">‚Äì</p>
            <p class="text-slate-400 mt-1">Entries counted in the current global snapshot.</p>
          </section>
          <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
            <p class="text-slate-400 uppercase tracking-[0.2em]">Updated</p>
            <p class="mt-1 text-slate-50 font-semibold" id="stat-last-updated">‚Äì</p>
            <p class="text-slate-400 mt-1">Time of the last refresh in your browser.</p>
          </section>
          <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
            <p class="text-slate-400 uppercase tracking-[0.2em]">Mood of the moment</p>
            <p class="mt-1 text-slate-50 font-semibold" id="stat-dominant-genre">‚Äì</p>
            <p class="text-slate-400 mt-1">Genre that dominates the current Top 50.</p>
          </section>
        </section>
      </section>

      <!-- Live playlist -->
      <section class="flex-1 flex flex-col gap-3">
        <section
          class="rounded-2xl bg-slate-950/80 border border-slate-800 overflow-hidden shadow-inner flex flex-col">
          <header class="p-3 border-b border-slate-800 flex items-center justify-between">
            <section>
              <p class="text-[11px] uppercase tracking-[0.24em] text-emerald-400">
                SoundCloud live player
              </p>
              <p class="text-[11px] text-slate-300/90">
                Press play and scroll ‚Äì the soundtrack follows you across the page.
              </p>
            </section>
          </header>
          <section id="sc-player" class="flex-1 min-h-[220px] flex items-center justify-center">
            <p class="text-[11px] text-slate-400">
              Loading SoundCloud player.
            </p>
          </section>
        </section>

        <!-- Genre filter -->
        <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 p-3">
          <p class="text-[11px] uppercase tracking-[0.22em] text-slate-400">
            Focus on your sound
          </p>
          <section class="mt-2 flex flex-wrap gap-1.5 text-[11px]">
            <button data-genre-filter="all"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-emerald-500 text-slate-950 font-semibold">
              All
            </button>
            <button data-genre-filter="house"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80">
              House
            </button>
            <button data-genre-filter="trance"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80">
              Trance
            </button>
            <button data-genre-filter="techno"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80">
              Techno
            </button>
            <button data-genre-filter="other"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80">
              Other
            </button>
          </section>
          <p class="mt-1 text-[11px] text-slate-400">
            Use the filter to highlight the tracks that match your current mood or DJ set.
          </p>
        </section>
      </section>
    </section>
  </section>

  <!-- TOP 50 -->
  <section id="top50"
           class="rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-6 space-y-3">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <section>
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Top 50 global EDM, house & trance tracks
        </h2>
        <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
          The Top 50 section shows which tracks are resonating with listeners across the scene. 
          Peaks, plateaus and hidden slow-burners end up side by side, giving you an instant snapshot of what 
          people keep coming back to when they want energy, emotion or a late-night release.
        </p>
      </section>
      <section class="flex items-center gap-2 text-[11px]">
        <button id="btn-refresh-top"
                type="button"
                class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80 text-slate-100">
          Refresh chart
        </button>
        <p id="top50-status" class="text-slate-400" aria-live="polite"></p>
      </section>
    </header>

    <section class="mt-2 grid grid-cols-2 sm:grid-cols-4 gap-2 text-[11px] text-slate-300">
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-2">
        <p class="uppercase tracking-[0.2em] text-slate-500">Most played</p>
        <p id="stat-top-track" class="mt-1 text-slate-50 font-semibold truncate">‚Äì</p>
      </section>
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-2">
        <p class="uppercase tracking-[0.2em] text-slate-500">Key artist</p>
        <p id="stat-top-artist" class="mt-1 text-slate-50 font-semibold truncate">‚Äì</p>
      </section>
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-2">
        <p class="uppercase tracking-[0.2em] text-slate-500">Average plays</p>
        <p id="stat-avg-plays" class="mt-1 text-slate-50 font-semibold">‚Äì</p>
      </section>
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-2">
        <p class="uppercase tracking-[0.2em] text-slate-500">Genres in the mix</p>
        <p id="stat-genre-count" class="mt-1 text-slate-50 font-semibold">‚Äì</p>
      </section>
    </section>

    <section class="mt-3 rounded-2xl bg-slate-950/80 border border-slate-800/90 max-h-[460px] overflow-y-auto"
             aria-live="polite"
             aria-busy="false"
             id="top50-list">
      <section class="p-3 space-y-2" id="top50-skeleton">
        <p class="text-[11px] text-slate-400">Loading live Top 50.</p>
        <section class="animate-pulse space-y-2">
          <section class="h-10 rounded-xl bg-slate-800/60"></section>
          <section class="h-10 rounded-xl bg-slate-800/60"></section>
          <section class="h-10 rounded-xl bg-slate-800/60"></section>
        </section>
      </section>
    </section>
  </section>

  <!-- MID CONTENT + AD -->
  <section class="rounded-3xl bg-slate-950/90 border border-slate-800/90 p-4 sm:p-5">
    <header>
      <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
        Spotlight & partners
      </h2>
    </header>
    <section class="mt-2 grid gap-3 sm:grid-cols-3 items-center">
      <section class="sm:col-span-2 text-[11px] sm:text-[13px] text-slate-300/90 space-y-1.5">
        <p>
          Between underground labels, bedroom producers and festival headliners, the EDM world moves fast. 
          EDM VERSEX uses the Top 50 and Latest sections as a radar, then turns those signals into playlists, 
          stories and artist spotlights.
        </p>
        <p>
          This block is also where occasional partners and events appear: curated club nights, hardware brands, 
          sample packs and platforms that make sense for electronic music fans. When you see a featured partner here,
          it is always in the context of the music, not the other way around.
        </p>
      </section>
      <section class="sm:col-span-1">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-4201977277980522"
             data-ad-slot="0987654321"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
          window.addEventListener("load", function () {
            try {
              (adsbygoogle = window.adsbygoogle || []).push({});
            } catch (e) {
              console.warn("AdSense mid content error", e);
            }
          });
        </script>
      </section>
    </section>
  </section>

  <!-- LATEST 20 -->
  <section id="latest"
           class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-6 space-y-3">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <section>
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Latest 20 global releases
        </h2>
        <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
          When you want to jump straight into the newest wave of tracks, the Latest 20 section is your shortcut. 
          Fresh uploads from different corners of the scene appear here with their titles, artists and genres, 
          ready to be explored before they hit the bigger playlists.
        </p>
      </section>
      <section class="flex items-center gap-2 text-[11px]">
        <button id="btn-refresh-latest"
                type="button"
                class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80 text-slate-100">
          Refresh latest
        </button>
        <p id="latest-status" class="text-slate-400" aria-live="polite"></p>
      </section>
    </header>

    <section class="mt-2 rounded-2xl bg-slate-950/80 border border-slate-800/90 max-h-[380px] overflow-y-auto"
             id="latest-list"
             aria-live="polite"
             aria-busy="false">
      <section class="p-3 space-y-2" id="latest-skeleton">
        <p class="text-[11px] text-slate-400">Loading latest releases.</p>
        <section class="animate-pulse space-y-2">
          <section class="h-12 rounded-xl bg-slate-800/60"></section>
          <section class="h-12 rounded-xl bg-slate-800/60"></section>
        </section>
      </section>
    </section>
  </section>

  <!-- GUIDES -->
  <section id="guides"
           class="rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-6 space-y-4">
    <header>
      <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
        Editorial guides & listening paths
      </h2>
      <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
        Charts are only the starting point. EDM VERSEX also offers written guides for listeners and creators:
        how to read the lists, how to build sets from them and how to discover details that might be easy to 
        miss in a crowded feed.
      </p>
    </header>

    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <article class="rounded-2xl bg-slate-950/80 border border-slate-800 p-4 space-y-2 text-sm sm:text-[13px] text-slate-300/90">
        <h3 class="text-[13px] font-semibold text-emerald-400 uppercase tracking-[0.2em]">
          From chart to DJ set
        </h3>
        <p>
          Start by listening through the first ten tracks of the Top 50 and mark the moments that instantly grab you: 
          a vocal phrase, a bass hook, a breakdown that gives you goosebumps. Those pieces can become anchors in a 
          future DJ set or playlist.
        </p>
        <p>
          Then scroll further down the list and search for contrasts. Pair a warm, rolling house track with a 
          colder, metallic techno piece or move from euphoric trance into deeper progressive sounds. 
          EDM VERSEX is designed so that quick scanning and slow, critical listening both feel natural.
        </p>
      </article>

      <article class="rounded-2xl bg-slate-950/80 border border-slate-800 p-4 space-y-2 text-sm sm:text-[13px] text-slate-300/90">
        <h3 class="text-[13px] font-semibold text-sky-400 uppercase tracking-[0.2em]">
          Using the Latest 20 as a discovery tool
        </h3>
        <p>
          The Latest 20 list is your early access tunnel. Before tracks are remixed, reposted and shared everywhere, 
          they quietly appear here as raw uploads. Pick a day of the week when you sit down with headphones, 
          no distractions, and explore the full column from top to bottom.
        </p>
        <p>
          Save anything that feels different, imperfect or surprising. Some of the most interesting club records 
          start as experiments that do not fit into obvious genre boxes. The role of EDM VERSEX is to give those 
          experiments a visible place next to the more established sounds.
        </p>
      </article>
    </section>

    <section class="rounded-2xl bg-slate-950/80 border border-slate-800 p-4 space-y-2 text-sm sm:text-[13px] text-slate-300/90">
      <h3 class="text-[13px] font-semibold text-fuchsia-400 uppercase tracking-[0.2em]">
        For producers and labels
      </h3>
      <p>
        If you write or release music, the front page of EDM VERSEX can be treated like a compass. 
        Watching which sounds appear together gives a sense of how listeners move through tempos and styles 
        during a night out. It can suggest when a stripped-back roller works better than a huge vocal, 
        or when a melodic breakdown is exactly what the mood needs.
      </p>
      <p>
        Over time the site will host interviews, breakdowns of key tracks, production notes and label profiles. 
        The core idea is simple: document what makes electronic dance music feel alive in clubs, cars and headphones, 
        and give that energy a permanent home on the web under the name EDM VERSEX.
      </p>
    </section>
  </section>

  <!-- ABOUT -->
  <section id="about"
           class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-6 space-y-3">
    <header>
      <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
        About EDM VERSEX
      </h2>
    </header>
    <section class="space-y-2 text-sm sm:text-[15px] leading-relaxed text-slate-300/90">
      <p>
        EDM VERSEX is a project built for people who stay up late to chase new grooves. 
        It lives between club culture, online discovery and that private moment when you find a track 
        that feels like it was written just for you.
      </p>
      <p>
        The site focuses on house, trance, techno and the cross-genres that connect them: future rave, 
        melodic techno, progressive journeys and hypnotic after-hours cuts. Live charts show what is bubbling, 
        while the editorial side slows down, listens and writes about the details.
      </p>
      <p>
        As the project grows, EDM VERSEX will introduce regular features such as ‚ÄúTrack of the Week‚Äù, 
        scene reports from different cities, guest mixes and possibly a newsletter for deeper dives. 
        At its core it remains what it is on this page: a clean, focused space where electronic dance music 
        and the people who love it come first.
      </p>
    </section>
  </section>
</main>

<!-- FOOTER -->
<footer class="fixed bottom-0 left-0 right-0 z-40">
  <section class="mx-auto max-w-6xl px-4 pb-[env(safe-area-inset-bottom)]">
    <section
      class="rounded-2xl bg-slate-950/95 border border-slate-800/90 backdrop-blur-xl shadow-edm-soft px-3 py-2 flex flex-col gap-1">
      <section class="flex items-center justify-between gap-2 text-[10px] text-slate-400">
        <p>¬© <span id="year"></span> EDM VERSEX. All rights reserved.</p>
        <a href="#top" class="underline">Back to top</a>
      </section>
      <section class="flex items-center justify-between text-[11px]">
        <nav class="flex items-center gap-1.5">
          <a href="#top50"
             class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">üìà</span><span>Top 50</span>
          </a>
          <a href="#latest"
             class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">üÜï</span><span>Latest</span>
          </a>
          <a href="#guides"
             class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">üìö</span><span>Guides</span>
          </a>
        </nav>
        <a href="privacy.html" class="text-[10px] underline">
          Privacy and cookies
        </a>
      </section>
    </section>
  </section>
</footer>

<noscript>
  <section class="mx-auto max-w-6xl mt-4 px-4">
    <section class="rounded-2xl bg-red-900/80 text-red-100 p-3 text-xs">
      JavaScript is disabled in your browser. Live charts and SoundCloud features cannot be loaded,
      but editorial content is still available.
    </section>
  </section>
</noscript>

<!-- APP LOGIC (unchanged) -->
<script>
  (function () {
    "use strict";

    // Worker base (no trailing slash)
    const WORKER_BASE = "https://royal-union-d5f0.kalleuusitalo1.workers.dev";

    const TOP_50_ENDPOINT = WORKER_BASE + "/api/top50";
    const LATEST_ENDPOINT = WORKER_BASE + "/api/latest";
    const PLAYER_ENDPOINT = WORKER_BASE + "/api/player-url";

    const top50Container = document.getElementById("top50-list");
    const top50Skeleton = document.getElementById("top50-skeleton");
    const top50Status = document.getElementById("top50-status");
    const btnRefreshTop = document.getElementById("btn-refresh-top");

    const latestContainer = document.getElementById("latest-list");
    const latestSkeleton = document.getElementById("latest-skeleton");
    const latestStatus = document.getElementById("latest-status");
    const btnRefreshLatest = document.getElementById("btn-refresh-latest");

    const statTrackCount = document.getElementById("stat-track-count");
    const statLastUpdated = document.getElementById("stat-last-updated");
    const statDominantGenre = document.getElementById("stat-dominant-genre");
    const statTopTrack = document.getElementById("stat-top-track");
    const statTopArtist = document.getElementById("stat-top-artist");
    const statAvgPlays = document.getElementById("stat-avg-plays");
    const statGenreCount = document.getElementById("stat-genre-count");

    const scPlayerBox = document.getElementById("sc-player");

    let top50Data = [];
    let latestData = [];
    let currentGenreFilter = "all";

    function setText(el, text) {
      if (el) el.textContent = String(text || "");
    }
    function formatNumber(n) {
      if (typeof n !== "number") n = Number(n || 0);
      if (Number.isNaN(n)) return "-";
      if (n >= 1000000) return (n / 1000000).toFixed(1) + "M";
      if (n >= 1000) return (n / 1000).toFixed(1) + "k";
      return n.toString();
    }
    function normalizeGenre(genre) {
      const g = String(genre || "").toLowerCase();
      if (g.includes("house")) return "house";
      if (g.includes("trance")) return "trance";
      if (g.includes("techno")) return "techno";
      return "other";
    }

    function renderTop50() {
      if (!top50Container) return;
      top50Container.setAttribute("aria-busy", "true");
      if (top50Skeleton) top50Skeleton.style.display = "none";

      const html = top50Data.map(function (track) {
        const normGenre = normalizeGenre(track.genre);
        const highlighted = currentGenreFilter === "all" || currentGenreFilter === normGenre;
        const highlightClass = highlighted
          ? "border-emerald-500/70 bg-slate-900/90"
          : "border-slate-800 bg-slate-950/80 opacity-80";

        return (
          '<article class="m-1 rounded-2xl border ' + highlightClass +
          ' p-2.5 flex items-center gap-3 text-[11px] sm:text-[13px]">' +
          '  <section class="flex flex-col items-center justify-center w-7">' +
          '    <span class="text-xs font-semibold text-slate-300">#' + String(track.rank || "?") + "</span>" +
          "  </section>" +
          '  <section class="flex-1 min-w-0">' +
          '    <p class="text-[10px] uppercase tracking-[0.2em] text-slate-400">' +
          (track.genre || "EDM") + "</p>" +
          '    <a href="' + (track.url || "#") + '" target="_blank" rel="noopener noreferrer"' +
          '       class="block truncate text-slate-50 font-semibold hover:text-emerald-400">' +
          (track.title || "Untitled track") + "</a>" +
          '    <p class="text-[11px] text-slate-400 truncate">by ' + (track.artist || "Unknown artist") + "</p>" +
          "  </section>" +
          '  <section class="flex flex-col items-end text-right text-[10px] text-slate-400 gap-0.5">' +
          '    <span>üéß ' + formatNumber(track.plays || 0) + " plays</span>" +
          '    <a href="' + (track.url || "#") + '" target="_blank" rel="noopener noreferrer"' +
          '       class="inline-flex items-center justify-center px-2 py-0.5 rounded-full border border-emerald-500/80 text-[10px] text-emerald-400 hover:bg-emerald-500 hover:text-slate-950 transition-colors">' +
          "      Open" +
          "    </a>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      top50Container.innerHTML = html;
      top50Container.setAttribute("aria-busy", "false");
    }

    function renderLatest() {
      if (!latestContainer) return;
      latestContainer.setAttribute("aria-busy", "true");
      if (latestSkeleton) latestSkeleton.style.display = "none";

      const html = latestData.map(function (rel) {
        return (
          '<article class="m-1 rounded-2xl border border-slate-800 bg-slate-950/80 p-3 flex items-center gap-3 text-[11px] sm:text-[13px]">' +
          '  <section class="flex-1 min-w-0">' +
          '    <p class="text-[10px] uppercase tracking-[0.2em] text-sky-400">' + (rel.genre || "EDM") + "</p>" +
          '    <a href="' + (rel.url || "#") + '" target="_blank" rel="noopener noreferrer"' +
          '       class="block truncate text-slate-50 font-semibold hover:text-emerald-400">' +
          (rel.title || "Untitled track") + "</a>" +
          '    <p class="text-[11px] text-slate-400 truncate">by ' + (rel.artist || "Unknown artist") + "</p>" +
          '    <p class="text-[10px] text-slate-500 mt-0.5">' +
          (rel.uploaded_at || "") + "</p>" +
          "  </section>" +
          '  <section class="flex flex-col items-end text-right gap-1 text-[10px] text-slate-400">' +
          '    <a href="' + (rel.url || "#") + '" target="_blank" rel="noopener noreferrer"' +
          '       class="inline-flex items-center justify-center px-2.5 py-0.5 rounded-full bg-slate-900/80 border border-slate-700/80 hover:bg-slate-800">' +
          "      Open" +
          "    </a>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      latestContainer.innerHTML = html;
      latestContainer.setAttribute("aria-busy", "false");
    }

    function updateStats() {
      if (!top50Data || top50Data.length === 0) return;

      setText(statTrackCount, top50Data.length);
      const now = new Date();
      setText(statLastUpdated, now.toLocaleTimeString());

      const topTrack = top50Data[0];
      setText(statTopTrack, topTrack ? topTrack.title : "‚Äì");
      setText(statTopArtist, topTrack ? topTrack.artist : "‚Äì");

      let totalPlays = 0;
      const genreMap = {};
      top50Data.forEach(function (t) {
        const plays = typeof t.plays === "number" ? t.plays : Number(t.plays || 0);
        if (!Number.isNaN(plays)) totalPlays += plays;
        const norm = normalizeGenre(t.genre);
        genreMap[norm] = (genreMap[norm] || 0) + 1;
      });

      const avg = totalPlays / top50Data.length;
      setText(statAvgPlays, formatNumber(Math.round(avg)));

      const genres = Object.keys(genreMap);
      setText(statGenreCount, genres.length);
      const dominant = genres.sort(function (a, b) {
        return (genreMap[b] || 0) - (genreMap[a] || 0);
      })[0];
      setText(statDominantGenre, dominant ? dominant.toUpperCase() : "MIXED");
    }

    async function fetchJSON(url) {
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      return res.json();
    }

    async function loadTop50() {
      try {
        setText(top50Status, "Loading.");
        const data = await fetchJSON(TOP_50_ENDPOINT);
        if (!Array.isArray(data) || data.length === 0) {
          setText(top50Status, "No data from backend");
          return;
        }
        top50Data = data;
        renderTop50();
        updateStats();
        setText(top50Status, "Updated");
      } catch (err) {
        console.error("Top50 error", err);
        setText(top50Status, "Error loading chart");
      }
    }

    async function loadLatest() {
      try {
        setText(latestStatus, "Loading.");
        const data = await fetchJSON(LATEST_ENDPOINT);
        if (!Array.isArray(data) || data.length === 0) {
          setText(latestStatus, "No latest releases");
          return;
        }
        latestData = data;
        renderLatest();
        setText(latestStatus, "Updated");
      } catch (err) {
        console.error("Latest error", err);
        setText(latestStatus, "Error loading latest");
      }
    }

    async function loadPlayer() {
      if (!scPlayerBox) return;
      try {
        const data = await fetchJSON(PLAYER_ENDPOINT);
        if (!data || !data.url) {
          scPlayerBox.innerHTML =
            '<p class="text-[11px] text-slate-400 px-3 py-2">Cannot load player. No valid latest track.</p>';
          return;
        }
        const src =
          "https://w.soundcloud.com/player/?url=" +
          encodeURIComponent(data.url) +
          "&color=%2322c55e&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true";

        scPlayerBox.innerHTML = `
          <iframe
              title="EDM VERSEX latest track"
              width="100%"
              height="260"
              scrolling="no"
              frameborder="no"
              allow="autoplay"
              src="${src}">
          </iframe>`;
      } catch (err) {
        console.error("Player load error", err);
        scPlayerBox.innerHTML =
          '<p class="text-[11px] text-slate-400 px-3 py-2">Error loading SoundCloud player.</p>';
      }
    }

    const filterButtons = document.querySelectorAll(".genre-filter-btn");
    filterButtons.forEach(function (btn) {
      btn.addEventListener("click", function () {
        const filter = btn.getAttribute("data-genre-filter") || "all";
        currentGenreFilter = filter;

        filterButtons.forEach(function (b) {
          b.classList.remove("bg-emerald-500", "text-slate-950");
          b.classList.add("bg-slate-950/80", "border-slate-700/80", "text-slate-100");
        });
        btn.classList.remove("bg-slate-950/80", "text-slate-100");
        btn.classList.add("bg-emerald-500", "text-slate-950");

        renderTop50();
      });
    });

    const yearSpan = document.getElementById("year");
    if (yearSpan) {
      yearSpan.textContent = new Date().getFullYear();
    }

    if (btnRefreshTop) btnRefreshTop.addEventListener("click", loadTop50);
    if (btnRefreshLatest) btnRefreshLatest.addEventListener("click", loadLatest);

    loadTop50();
    loadLatest();
    loadPlayer();

    const canvas = document.getElementById("wave-canvas");
    if (canvas) {
      const ctx = canvas.getContext("2d");
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener("resize", resize);

      let t = 0;
      function draw() {
        if (!ctx) return;
        const w = canvas.width;
        const h = canvas.height;
        ctx.clearRect(0, 0, w, h);
        ctx.lineWidth = 1.2;

        const gradients = [
          { color: "rgba(34,197,94,0.45)", amp: 32, speed: 0.0018 },
          { color: "rgba(56,189,248,0.40)", amp: 42, speed: 0.0012 },
          { color: "rgba(244,114,182,0.35)", amp: 56, speed: 0.0009 }
        ];

        gradients.forEach(function (g, i) {
          ctx.beginPath();
          ctx.strokeStyle = g.color;
          const yBase = h * (0.3 + 0.15 * i);
          for (let x = 0; x <= w; x += 8) {
            const y = yBase +
              Math.sin((x * 0.01) + t * g.speed * 260) * g.amp *
              Math.cos(t * g.speed * 120 + i);
            if (x === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();
        });

        t++;
        requestAnimationFrame(draw);
      }
      draw();
    }
  })();
</script>

</body>
</html>
