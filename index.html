<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EDM VERSEX | Global EDM Top 50 & Latest SoundCloud Releases</title>

  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <meta name="description"
        content="EDM VERSEX is a live electronic dance music hub with global SoundCloud-based Top 50 charts, latest releases and editorial highlights for EDM, house and trance.">
  <meta name="keywords"
        content="EDM, electronic dance music, house, trance, techno, SoundCloud, Top 50, latest releases, charts, DJs, producers">
  <meta name="author" content="EDM VERSEX">

  <!-- Open Graph -->
  <meta property="og:title" content="EDM VERSEX | Global EDM Top 50 & Latest SoundCloud Releases">
  <meta property="og:description"
        content="Explore global SoundCloud charts, fresh EDM releases and curated insights in an immersive audio-inspired interface.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://edmversex.com/">
  <meta property="og:image" content="https://edmversex.com/assets/edmversex-cover.jpg">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="EDM VERSEX | Global EDM Top 50 & Latest Releases">
  <meta name="twitter:description"
        content="Live EDM hub with SoundCloud powered Top 50, latest releases and editorial highlights.">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icon-180.png">

  <!-- Google AdSense (global script) -->
  <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4201977277980522"
          crossorigin="anonymous"></script>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1KFLYZ78XS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config", "G-1KFLYZ78XS");
  </script>

  <!-- Tailwind (UI) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "edm-bg": "#020617",
            "edm-panel": "rgba(15,23,42,0.96)",
            "edm-glass": "rgba(15,23,42,0.80)",
            "edm-accent": "#22c55e",
            "edm-highlight": "#38bdf8"
          },
          boxShadow: {
            "edm-soft": "0 28px 80px rgba(15,23,42,0.92)"
          }
        }
      }
    };
  </script>

  <style>
    html, body {
      max-width: 100%;
      overflow-x: hidden;
      scroll-behavior: smooth;
      background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
    }

    :focus-visible {
      outline: 2px solid #22c55e;
      outline-offset: 3px;
    }

    #wave-canvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0.55;
      mix-blend-mode: screen;
      z-index: -1;
    }
  </style>
</head>
<body class="min-h-screen text-slate-50 antialiased bg-edm-bg relative">

<a href="#main"
   class="sr-only focus:not-sr-only focus:fixed focus:z-50 focus:top-3 focus:left-3 focus:px-4 focus:py-2 focus:rounded-full focus:bg-slate-900 focus:text-emerald-400">
  Skip to main content
</a>

<canvas id="wave-canvas"></canvas>

<!-- HEADER -->
<header class="sticky top-0 z-40 backdrop-blur-2xl bg-slate-950/90 border-b border-slate-800/80">
  <nav class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
    <a href="#top" class="flex items-center gap-2" aria-label="EDM VERSEX home">
      <span
        class="inline-flex h-9 w-9 rounded-full bg-gradient-to-tr from-emerald-500 via-sky-500 to-fuchsia-500 items-center justify-center shadow-lg shadow-emerald-500/40">
        <span class="h-3 w-3 rounded-full bg-slate-950"></span>
      </span>
      <span class="flex flex-col leading-tight">
        <span class="text-xs font-semibold tracking-[0.22em] uppercase text-emerald-400">EDM VERSEX</span>
        <span class="text-[11px] text-slate-300/90">Global EDM charts & live releases</span>
      </span>
    </a>

    <nav class="ml-auto hidden md:flex items-center gap-2 text-[11px]">
      <a href="#top50" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Top 50</a>
      <a href="#latest" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Latest 20</a>
      <a href="#editorial" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Editorial</a>
      <a href="#trends" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Trends</a>
    </nav>
  </nav>

  <!-- Top banner ad -->
  <section class="mx-auto max-w-6xl px-4 pb-3">
    <section class="rounded-2xl border border-slate-800 bg-slate-900/90 p-2 flex items-center justify-center min-h-[120px]">
      <!-- HEADER DISPLAY AD -->
      <ins class="adsbygoogle header-ad"
           style="display:block; width:100%; min-height:120px"
           data-ad-client="ca-pub-4201977277980522"
           data-ad-slot="1234567890"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
    </section>
  </section>
</header>

<main id="main" class="mx-auto max-w-6xl px-4 pt-4 pb-28 space-y-6">

  <!-- HERO -->
  <section id="top"
           class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-6 lg:p-7 relative overflow-hidden">
    <section class="absolute inset-0 pointer-events-none opacity-40">
      <section class="absolute -top-10 -left-10 w-40 h-40 rounded-full bg-emerald-500 blur-3xl"></section>
      <section class="absolute -bottom-16 -right-16 w-56 h-56 rounded-full bg-sky-500 blur-3xl"></section>
    </section>

    <section class="relative flex flex-col lg:flex-row gap-6 lg:gap-10">
      <section class="flex-1 space-y-3">
        <p class="text-[11px] font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Live electronic dance music hub
        </p>
        <h1 class="text-xl sm:text-2xl lg:text-3xl font-semibold text-slate-50">
          Global SoundCloud charts, fresh EDM releases and editorial highlights in one immersive view.
        </h1>
        <p class="text-sm sm:text-[15px] text-slate-300/90">
          EDM VERSEX focuses on electronic dance music, house and trance. The sections below update automatically
          as new tracks appear on SoundCloud, so you always land on a living snapshot of the scene.
        </p>

        <section class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3 text-[11px] sm:text-xs">
          <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
            <p class="text-slate-400 uppercase tracking-[0.2em]">Tracks monitored</p>
            <p class="mt-1 text-slate-50 font-semibold" id="stat-track-count">‚Äì</p>
            <p class="text-slate-400 mt-1">Total tracks scanned for the current chart.</p>
          </section>
          <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
            <p class="text-slate-400 uppercase tracking-[0.2em]">Last update</p>
            <p class="mt-1 text-slate-50 font-semibold" id="stat-last-updated">‚Äì</p>
            <p class="text-slate-400 mt-1">Local time of the latest refresh.</p>
          </section>
          <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
            <p class="text-slate-400 uppercase tracking-[0.2em]">Dominant mood</p>
            <p class="mt-1 text-slate-50 font-semibold" id="stat-dominant-genre">‚Äì</p>
            <p class="text-slate-400 mt-1">Most represented sound in today‚Äôs chart.</p>
          </section>
        </section>
      </section>

      <!-- Live playlist + genre filter -->
      <section class="flex-1 flex flex-col gap-3">
        <section
          class="rounded-2xl bg-slate-950/80 border border-slate-800 overflow-hidden shadow-inner flex flex-col">
          <header class="p-3 border-b border-slate-800 flex items-center justify-between">
            <section>
              <p class="text-[11px] uppercase tracking-[0.24em] text-emerald-400">
                SoundCloud live player
              </p>
              <p class="text-[11px] text-slate-300/90">
                Stream a fresh global track while exploring the data below.
              </p>
            </section>
          </header>
          <section id="sc-player" class="flex-1 min-h-[220px] flex items-center justify-center">
            <p class="text-[11px] text-slate-400">
              Loading SoundCloud player‚Ä¶
            </p>
          </section>
        </section>

        <!-- Genre filter -->
        <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 p-3">
          <p class="text-[11px] uppercase tracking-[0.22em] text-slate-400">
            Highlight by sound
          </p>
          <section class="mt-2 flex flex-wrap gap-1.5 text-[11px]">
            <button data-genre-filter="all"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-emerald-500 text-slate-950 font-semibold">
              All
            </button>
            <button data-genre-filter="house"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80 text-slate-100">
              House
            </button>
            <button data-genre-filter="trance"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80 text-slate-100">
              Trance
            </button>
            <button data-genre-filter="techno"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80 text-slate-100">
              Techno
            </button>
            <button data-genre-filter="other"
                    class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80 text-slate-100">
              Other
            </button>
          </section>
          <p class="mt-1 text-[11px] text-slate-400">
            The filter highlights matching entries inside the Top 50 list.
          </p>
        </section>
      </section>
    </section>
  </section>

  <!-- TOP 50 -->
  <section id="top50"
           class="rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-6 space-y-3">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <section>
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Global Top 50 ‚Äì EDM / house / trance
        </h2>
        <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
          Tracks are collected from public SoundCloud releases and ordered by a mix of play count and freshness.
          Use the list as a discovery feed or a programming tool for your next set.
        </p>
      </section>
      <section class="flex items-center gap-2 text-[11px]">
        <button id="btn-refresh-top"
                type="button"
                class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80 text-slate-100">
          Refresh chart
        </button>
        <p id="top50-status" class="text-slate-400" aria-live="polite"></p>
      </section>
    </header>

    <section class="mt-2 grid grid-cols-2 sm:grid-cols-4 gap-2 text-[11px] text-slate-300">
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-2">
        <p class="uppercase tracking-[0.2em] text-slate-500">Most played track</p>
        <p id="stat-top-track" class="mt-1 text-slate-50 font-semibold truncate">‚Äì</p>
      </section>
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-2">
        <p class="uppercase tracking-[0.2em] text-slate-500">Key artist</p>
        <p id="stat-top-artist" class="mt-1 text-slate-50 font-semibold truncate">‚Äì</p>
      </section>
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-2">
        <p class="uppercase tracking-[0.2em] text-slate-500">Average plays</p>
        <p id="stat-avg-plays" class="mt-1 text-slate-50 font-semibold">‚Äì</p>
      </section>
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-2">
        <p class="uppercase tracking-[0.2em] text-slate-500">Genres represented</p>
        <p id="stat-genre-count" class="mt-1 text-slate-50 font-semibold">‚Äì</p>
      </section>
    </section>

    <!-- In-feed ad between hero and list -->
    <section class="mt-3 rounded-2xl bg-slate-950/90 border border-slate-800/90 p-2 min-h-[100px]">
      <!-- IN-FEED AD UNIT -->
      <ins class="adsbygoogle infeed-ad"
           style="display:block; width:100%; min-height:100px"
           data-ad-client="ca-pub-4201977277980522"
           data-ad-slot="0987654321"
           data-ad-format="fluid"
           data-ad-layout-key="-gw-3+1f-3d+2z"></ins>
    </section>

    <section class="mt-3 rounded-2xl bg-slate-950/80 border border-slate-800/90 max-h-[460px] overflow-y-auto"
             aria-live="polite"
             aria-busy="false"
             id="top50-list">
      <section class="p-3 space-y-2" id="top50-skeleton">
        <p class="text-[11px] text-slate-400">Loading global Top 50‚Ä¶</p>
        <section class="animate-pulse space-y-2">
          <section class="h-10 rounded-xl bg-slate-800/60"></section>
          <section class="h-10 rounded-xl bg-slate-800/60"></section>
          <section class="h-10 rounded-xl bg-slate-800/60"></section>
        </section>
      </section>
    </section>
  </section>

  <!-- LATEST 20 -->
  <section id="latest"
           class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-6 space-y-3">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <section>
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Latest 20 global releases
        </h2>
        <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
          Fresh uploads from the global SoundCloud stream, ordered by upload date. This is where you spot the
          tracks that have just landed before they show up everywhere else.
        </p>
      </section>
      <section class="flex items-center gap-2 text-[11px]">
        <button id="btn-refresh-latest"
                type="button"
                class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80 text-slate-100">
          Refresh latest
        </button>
        <p id="latest-status" class="text-slate-400" aria-live="polite"></p>
      </section>
    </header>

    <section class="mt-2 rounded-2xl bg-slate-950/80 border border-slate-800/90 max-h-[380px] overflow-y-auto"
             id="latest-list"
             aria-live="polite"
             aria-busy="false">
      <section class="p-3 space-y-2" id="latest-skeleton">
        <p class="text-[11px] text-slate-400">Loading latest global releases‚Ä¶</p>
        <section class="animate-pulse space-y-2">
          <section class="h-12 rounded-xl bg-slate-800/60"></section>
          <section class="h-12 rounded-xl bg-slate-800/60"></section>
        </section>
      </section>
    </section>
  </section>

  <!-- EDITORIAL & AD ARTICLE -->
  <section id="editorial"
           class="rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-6 space-y-4">
    <header>
      <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
        Editorial pulse
      </h2>
      <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
        Short editorial notes about what is happening in the wider EDM world and how to travel through the lists
        on this page today.
      </p>
    </header>

    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <!-- Gemini editorial text -->
      <section class="rounded-2xl bg-slate-950/80 border border-slate-800 overflow-hidden">
        <header class="p-3 border-b border-slate-800">
          <p class="text-[11px] uppercase tracking-[0.22em] text-sky-400">
            Today‚Äôs listening guide
          </p>
        </header>
        <section class="p-3 text-[11px] sm:text-[13px] text-slate-300/90 space-y-2" id="editorial-text">
          <p>
            Loading a short editorial note about today‚Äôs global EDM atmosphere‚Ä¶
          </p>
        </section>
      </section>

      <!-- In-article ad + static info -->
      <section class="rounded-2xl bg-slate-950/80 border border-slate-800 overflow-hidden">
        <header class="p-3 border-b border-slate-800">
          <p class="text-[11px] uppercase tracking-[0.22em] text-emerald-400">
            Supported by ads
          </p>
        </header>
        <section class="p-3 space-y-3">
          <!-- IN-ARTICLE AD -->
          <ins class="adsbygoogle article-ad"
               style="display:block; width:100%; min-height:120px"
               data-ad-client="ca-pub-4201977277980522"
               data-ad-slot="1122334455"
               data-ad-format="autorelaxed"></ins>
          <p class="text-[11px] sm:text-[13px] text-slate-300/90">
            Ads help keep EDM VERSEX running while you discover new music. Ad placements are limited to
            rich content sections like this, never on empty screens or purely functional views.
          </p>
        </section>
      </section>
    </section>
  </section>

  <!-- TRENDS -->
  <section id="trends"
           class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-6 space-y-3">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <section>
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Search & culture trends around EDM
        </h2>
        <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
          A high-level snapshot of topics fans are exploring right now: genres, events, moods and formats
          connected to electronic dance music.
        </p>
      </section>
      <section class="flex items-center gap-2 text-[11px]">
        <p id="trends-status" class="text-slate-400" aria-live="polite"></p>
      </section>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-3 text-[11px] sm:text-[13px]" id="trends-list">
      <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-3">
        <p class="text-slate-400">Loading trend snapshot‚Ä¶</p>
      </section>
    </section>
  </section>
</main>

<!-- FOOTER / NAV + BOTTOM AD -->
<footer class="fixed bottom-0 left-0 right-0 z-40">
  <section class="mx-auto max-w-6xl px-4 pb-[env(safe-area-inset-bottom)]">
    <section
      class="rounded-2xl bg-slate-950/95 border border-slate-800/90 backdrop-blur-xl shadow-edm-soft px-3 py-2 flex flex-col gap-2">
      <!-- Bottom ad -->
      <section class="min-h-[70px]">
        <!-- ANCHOR/BOTTOM DISPLAY AD -->
        <ins class="adsbygoogle bottom-ad"
             style="display:block; width:100%; min-height:70px"
             data-ad-client="ca-pub-4201977277980522"
             data-ad-slot="6677889900"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </section>

      <section class="flex items-center justify-between gap-2 text-[10px] text-slate-400">
        <p>¬© <span id="year"></span> EDM VERSEX ¬∑ Global electronic dance music hub</p>
        <a href="#top" class="underline">Back to top</a>
      </section>
      <section class="flex items-center justify-between text-[11px]">
        <nav class="flex items-center gap-1.5">
          <a href="#top50"
             class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">üìà</span><span>Top 50</span>
          </a>
          <a href="#latest"
             class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">üÜï</span><span>Latest</span>
          </a>
          <a href="#editorial"
             class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">üìù</span><span>Editorial</span>
          </a>
        </nav>
        <a href="privacy.html" class="text-[10px] underline">
          Privacy & cookies
        </a>
      </section>
    </section>
  </section>
</footer>

<noscript>
  <section class="mx-auto max-w-6xl mt-4 px-4">
    <section class="rounded-2xl bg-red-900/80 text-red-100 p-3 text-xs">
      JavaScript is disabled. Live charts, latest releases and editorial content cannot be loaded, but static
      information still works.
    </section>
  </section>
</noscript>

<!-- APP LOGIC -->
<script>
  (function () {
    "use strict";

    // VAIHDA T√ÑM√Ñ, JOS WORKERIN OSOITE MUUTTUU
    const WORKER_BASE = "https://royal-union-d5f0.kalleuusitalo1.workers.dev";

    const TOP_50_ENDPOINT   = WORKER_BASE + "/api/top50";
    const LATEST_ENDPOINT   = WORKER_BASE + "/api/latest";
    const PLAYER_ENDPOINT   = WORKER_BASE + "/api/player-url";
    const EDITORIAL_ENDPOINT = WORKER_BASE + "/api/editorial";
    const TRENDS_ENDPOINT    = WORKER_BASE + "/api/trends-summary";

    const top50Container   = document.getElementById("top50-list");
    const top50Skeleton    = document.getElementById("top50-skeleton");
    const top50Status      = document.getElementById("top50-status");
    const btnRefreshTop    = document.getElementById("btn-refresh-top");

    const latestContainer  = document.getElementById("latest-list");
    const latestSkeleton   = document.getElementById("latest-skeleton");
    const latestStatus     = document.getElementById("latest-status");
    const btnRefreshLatest = document.getElementById("btn-refresh-latest");

    const statTrackCount   = document.getElementById("stat-track-count");
    const statLastUpdated  = document.getElementById("stat-last-updated");
    const statDominantGenre= document.getElementById("stat-dominant-genre");
    const statTopTrack     = document.getElementById("stat-top-track");
    const statTopArtist    = document.getElementById("stat-top-artist");
    const statAvgPlays     = document.getElementById("stat-avg-plays");
    const statGenreCount   = document.getElementById("stat-genre-count");

    const scPlayerBox      = document.getElementById("sc-player");
    const editorialBox     = document.getElementById("editorial-text");
    const trendsList       = document.getElementById("trends-list");
    const trendsStatus     = document.getElementById("trends-status");

    let top50Data = [];
    let latestData = [];
    let currentGenreFilter = "all";

    function setText(el, text) {
      if (el) el.textContent = String(text || "");
    }
    function formatNumber(n) {
      if (typeof n !== "number") n = Number(n || 0);
      if (Number.isNaN(n)) return "-";
      if (n >= 1_000_000) return (n / 1_000_000).toFixed(1) + "M";
      if (n >= 1_000) return (n / 1_000).toFixed(1) + "k";
      return n.toString();
    }
    function normalizeGenre(genre) {
      const g = String(genre || "").toLowerCase();
      if (g.includes("house")) return "house";
      if (g.includes("trance")) return "trance";
      if (g.includes("techno")) return "techno";
      return "other";
    }

    async function fetchJSON(url) {
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      return res.json();
    }

    // --- TOP 50 RENDER ---
    function renderTop50() {
      if (!top50Container) return;
      top50Container.setAttribute("aria-busy", "true");
      if (top50Skeleton) top50Skeleton.style.display = "none";

      const html = top50Data.map(function (track) {
        const normGenre = normalizeGenre(track.genre);
        const highlighted = currentGenreFilter === "all" || currentGenreFilter === normGenre;
        const highlightClass = highlighted
          ? "border-emerald-500/70 bg-slate-900/90"
          : "border-slate-800 bg-slate-950/80 opacity-80";

        return (
          '<article class="m-1 rounded-2xl border ' + highlightClass +
          ' p-2.5 flex items-center gap-3 text-[11px] sm:text-[13px]">' +
          '  <section class="flex flex-col items-center justify-center w-7">' +
          '    <span class="text-xs font-semibold text-slate-300">#' + String(track.rank || "?") + "</span>" +
          "  </section>" +
          '  <section class="flex-1 min-w-0">' +
          '    <p class="text-[10px] uppercase tracking-[0.2em] text-slate-400">' +
          (track.genre || "EDM") + "</p>" +
          '    <a href="' + (track.url || "#") + '" target="_blank" rel="noopener noreferrer"' +
          '       class="block truncate text-slate-50 font-semibold hover:text-emerald-400">' +
          (track.title || "Untitled track") + "</a>" +
          '    <p class="text-[11px] text-slate-400 truncate">by ' + (track.artist || "Unknown artist") + "</p>" +
          "  </section>" +
          '  <section class="flex flex-col items-end text-right text-[10px] text-slate-400 gap-0.5">' +
          '    <span>üéß ' + formatNumber(track.plays || 0) + " plays</span>" +
          '    <a href="' + (track.url || "#") + '" target="_blank" rel="noopener noreferrer"' +
          '       class="inline-flex items-center justify-center px-2 py-0.5 rounded-full border border-emerald-500/80 text-[10px] text-emerald-400 hover:bg-emerald-500 hover:text-slate-950 transition-colors">' +
          "      Open" +
          "    </a>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      top50Container.innerHTML = html;
      top50Container.setAttribute("aria-busy", "false");
    }

    // --- LATEST RENDER ---
    function renderLatest() {
      if (!latestContainer) return;
      latestContainer.setAttribute("aria-busy", "true");
      if (latestSkeleton) latestSkeleton.style.display = "none";

      const html = latestData.map(function (rel) {
        return (
          '<article class="m-1 rounded-2xl border border-slate-800 bg-slate-950/80 p-3 flex items-center gap-3 text-[11px] sm:text-[13px]">' +
          '  <section class="flex-1 min-w-0">' +
          '    <p class="text-[10px] uppercase tracking-[0.2em] text-sky-400">' + (rel.genre || "EDM") + "</p>" +
          '    <a href="' + (rel.url || "#") + '" target="_blank" rel="noopener noreferrer"' +
          '       class="block truncate text-slate-50 font-semibold hover:text-emerald-400">' +
          (rel.title || "Untitled track") + "</a>" +
          '    <p class="text-[11px] text-slate-400 truncate">by ' + (rel.artist || "Unknown artist") + "</p>" +
          '    <p class="text-[10px] text-slate-500 mt-0.5">' +
          (rel.uploaded_at || "") + "</p>" +
          "  </section>" +
          '  <section class="flex flex-col items-end text-right gap-1 text-[10px] text-slate-400">' +
          '    <a href="' + (rel.url || "#") + '" target="_blank" rel="noopener noreferrer"' +
          '       class="inline-flex items-center justify-center px-2.5 py-0.5 rounded-full bg-slate-900/80 border border-slate-700/80 hover:bg-slate-800">' +
          "      Open" +
          "    </a>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      latestContainer.innerHTML = html;
      latestContainer.setAttribute("aria-busy", "false");
    }

    function updateStats() {
      if (!top50Data || top50Data.length === 0) return;

      setText(statTrackCount, top50Data.length);
      const now = new Date();
      setText(statLastUpdated, now.toLocaleTimeString());

      const topTrack = top50Data[0];
      setText(statTopTrack, topTrack ? topTrack.title : "‚Äì");
      setText(statTopArtist, topTrack ? topTrack.artist : "‚Äì");

      let totalPlays = 0;
      const genreMap = {};
      top50Data.forEach(function (t) {
        const plays = typeof t.plays === "number" ? t.plays : Number(t.plays || 0);
        if (!Number.isNaN(plays)) totalPlays += plays;
        const norm = normalizeGenre(t.genre);
        genreMap[norm] = (genreMap[norm] || 0) + 1;
      });

      const avg = totalPlays / top50Data.length;
      setText(statAvgPlays, formatNumber(Math.round(avg)));

      const genres = Object.keys(genreMap);
      setText(statGenreCount, genres.length);
      const dominant = genres.sort(function (a, b) {
        return (genreMap[b] || 0) - (genreMap[a] || 0);
      })[0];
      setText(statDominantGenre, dominant ? dominant.toUpperCase() : "MIXED");
    }

    async function loadTop50() {
      try {
        setText(top50Status, "Loading‚Ä¶");
        const data = await fetchJSON(TOP_50_ENDPOINT);
        if (!Array.isArray(data) || data.length === 0) {
          setText(top50Status, "No data from backend");
          return;
        }
        top50Data = data;
        renderTop50();
        updateStats();
        setText(top50Status, "Updated");
      } catch (err) {
        console.error("Top50 error", err);
        setText(top50Status, "Error loading chart");
      }
    }

    async function loadLatest() {
      try {
        setText(latestStatus, "Loading‚Ä¶");
        const data = await fetchJSON(LATEST_ENDPOINT);
        if (!Array.isArray(data) || data.length === 0) {
          setText(latestStatus, "No latest releases");
          return;
        }
        latestData = data;
        renderLatest();
        setText(latestStatus, "Updated");
      } catch (err) {
        console.error("Latest error", err);
        setText(latestStatus, "Error loading latest");
      }
    }

    async function loadPlayer() {
      if (!scPlayerBox) return;
      try {
        const data = await fetchJSON(PLAYER_ENDPOINT);
        if (!data || !data.url) {
          scPlayerBox.innerHTML =
            '<p class="text-[11px] text-slate-400 px-3 py-2">No suitable global track available for the player right now.</p>';
          return;
        }
        const src =
          "https://w.soundcloud.com/player/?url=" +
          encodeURIComponent(data.url) +
          "&color=%2322c55e&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true";

        scPlayerBox.innerHTML = `
          <iframe 
              title="EDM VERSEX latest global track"
              width="100%" 
              height="260" 
              scrolling="no" 
              frameborder="no" 
              allow="autoplay"
              src="${src}">
          </iframe>`;
      } catch (err) {
        console.error("Player load error", err);
        scPlayerBox.innerHTML =
          '<p class="text-[11px] text-slate-400 px-3 py-2">Error loading SoundCloud player.</p>';
      }
    }

    async function loadEditorial() {
      if (!editorialBox) return;
      try {
        const data = await fetchJSON(EDITORIAL_ENDPOINT);
        const text = (data && data.text) ? String(data.text).trim() : "";
        editorialBox.innerHTML = "";
        const p = document.createElement("p");
        p.textContent = text || "Electronic dance music never stands still. Use today‚Äôs charts and latest drops as a map into new corners of house, trance and techno.";
        editorialBox.appendChild(p);
      } catch (err) {
        console.error("Editorial load error", err);
        editorialBox.innerHTML =
          '<p class="text-[11px] sm:text-[13px] text-slate-300/90">EDM VERSEX offers a constantly updated view into global club sounds. Start with the Top 50, then move to Latest 20 to hear what has just landed.</p>';
      }
    }

    async function loadTrends() {
      if (!trendsList) return;
      try {
        setText(trendsStatus, "Loading‚Ä¶");
        const data = await fetchJSON(TRENDS_ENDPOINT);
        const items = Array.isArray(data) ? data : (data && Array.isArray(data.items) ? data.items : []);
        if (!items.length) {
          setText(trendsStatus, "No trend data available");
          return;
        }
        const html = items.map(function (t) {
          return `
            <section class="rounded-xl bg-slate-950/80 border border-slate-800 p-3 flex flex-col gap-1">
              <p class="text-[11px] uppercase tracking-[0.2em] text-emerald-400">${t.category || "EDM"}</p>
              <p class="text-sm font-semibold text-slate-50">${t.term || "Trend"}</p>
              <p class="text-[11px] text-slate-400">${t.description || ""}</p>
              <p class="text-[10px] text-slate-500 flex justify-between mt-1">
                <span>${t.region || "Global"}</span>
                <span>${typeof t.score !== "undefined" ? "Score " + t.score : ""}${t.change ? " ¬∑ " + t.change : ""}</span>
              </p>
            </section>
          `;
        }).join("");
        trendsList.innerHTML = html;
        setText(trendsStatus, "Updated");
      } catch (err) {
        console.error("Trends error", err);
        setText(trendsStatus, "Trend snapshot unavailable");
      }
    }

    // Genre filter UI
    const filterButtons = document.querySelectorAll(".genre-filter-btn");
    filterButtons.forEach(function (btn) {
      btn.addEventListener("click", function () {
        const filter = btn.getAttribute("data-genre-filter") || "all";
        currentGenreFilter = filter;

        filterButtons.forEach(function (b) {
          b.classList.remove("bg-emerald-500", "text-slate-950");
          b.classList.add("bg-slate-950/80", "border-slate-700/80", "text-slate-100");
        });
        btn.classList.remove("bg-slate-950/80", "text-slate-100");
        btn.classList.add("bg-emerald-500", "text-slate-950");

        renderTop50();
      });
    });

    // Footer year
    const yearSpan = document.getElementById("year");
    if (yearSpan) {
      yearSpan.textContent = new Date().getFullYear();
    }

    // Buttons
    if (btnRefreshTop) btnRefreshTop.addEventListener("click", loadTop50);
    if (btnRefreshLatest) btnRefreshLatest.addEventListener("click", loadLatest);

    // Initial data load
    loadTop50();
    loadLatest();
    loadPlayer();
    loadEditorial();
    loadTrends();

    // AdSense: pusketaan mainokset vasta, kun layout on valmis
    window.addEventListener("load", function () {
      if (window.adsbygoogle && document.querySelectorAll(".adsbygoogle").length) {
        document.querySelectorAll(".adsbygoogle").forEach(function () {
          try {
            (adsbygoogle = window.adsbygoogle || []).push({});
          } catch (e) {
            console.warn("AdSense push error", e);
          }
        });
      }
    });

    // Immersive wave background
    const canvas = document.getElementById("wave-canvas");
    if (canvas) {
      const ctx = canvas.getContext("2d");
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener("resize", resize);

      let t = 0;
      function draw() {
        if (!ctx) return;
        const w = canvas.width;
        const h = canvas.height;
        ctx.clearRect(0, 0, w, h);
        ctx.lineWidth = 1.2;

        const gradients = [
          { color: "rgba(34,197,94,0.45)", amp: 32, speed: 0.0018 },
          { color: "rgba(56,189,248,0.40)", amp: 42, speed: 0.0012 },
          { color: "rgba(244,114,182,0.35)", amp: 56, speed: 0.0009 }
        ];

        gradients.forEach(function (g, i) {
          ctx.beginPath();
          ctx.strokeStyle = g.color;
          const yBase = h * (0.3 + 0.15 * i);
          for (let x = 0; x <= w; x += 8) {
            const y = yBase +
              Math.sin((x * 0.01) + t * g.speed * 260) * g.amp *
              Math.cos(t * g.speed * 120 + i);
            if (x === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();
        });

        t++;
        requestAnimationFrame(draw);
      }
      draw();
    }
  })();
</script>

</body>
</html>
