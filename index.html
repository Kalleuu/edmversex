<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EDM VERSEX | Global EDM Charts, Latest Tracks & Fan Votes</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="EDM VERSEX is a daily EDM hub with global SoundCloud-based charts, latest tracks, curated news and fan-powered Top Songs.">
  <meta name="keywords" content="EDM, electronic dance music, house, trance, techno, SoundCloud charts, latest tracks, EDM news, DJ, producer, club music">
  <meta name="author" content="EDM VERSEX">

  <meta property="og:title" content="EDM VERSEX | Global EDM Charts & Latest Tracks">
  <meta property="og:description" content="Follow global EDM trends with a daily SoundCloud snapshot, fresh releases, curated news and fan-voted Top Songs.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://edmversex.com/">
  <meta property="og:image" content="https://edmversex.com/assets/edmversex-cover.jpg">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="EDM VERSEX | Global EDM Charts & Latest Tracks">
  <meta name="twitter:description" content="Daily EDM hub for SoundCloud charts, latest releases, news and fan-voted favourites.">

  <link rel="icon" type="image/png" sizes="32x32" href="assets/icon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icon-180.png">

  <script async src="https://pagead2.googlesyndication.com/pagead/js?client=ca-pub-4201977277980522" crossorigin="anonymous"></script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1KFLYZ78XS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config", "G-1KFLYZ78XS");
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "edm-bg": "#020617",
            "edm-panel": "rgba(15,23,42,0.96)",
            "edm-glass": "rgba(15,23,42,0.85)",
            "edm-accent": "#22c55e",
            "edm-highlight": "#38bdf8"
          },
          boxShadow: {
            "edm-soft": "0 28px 80px rgba(15,23,42,0.92)"
          },
          borderRadius: {
            "3xl": "1.75rem"
          }
        }
      }
    };
  </script>

  <style>
    html, body {
      max-width: 100%;
      overflow-x: hidden;
      scroll-behavior: smooth;
      background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
    }
    :focus-visible {
      outline: 2px solid #22c55e;
      outline-offset: 3px;
    }
    #wave-canvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0.45;
      mix-blend-mode: screen;
      z-index: 0;
    }
  </style>
</head>
<body class="min-h-screen text-slate-50 antialiased bg-edm-bg relative">

<a href="#main"
   class="sr-only focus:not-sr-only focus:fixed focus:top-3 focus:left-3 focus:z-50 focus:px-4 focus:py-2 focus:rounded-full focus:bg-slate-900 focus:text-emerald-400">
  Skip to main content
</a>

<canvas id="wave-canvas"></canvas>

<header class="sticky top-0 z-30 backdrop-blur-2xl bg-slate-950/90 border-b border-slate-800/80">
  <section class="mx-auto max-w-5xl px-4 py-3 flex items-center gap-3">
    <a href="#top" class="flex items-center gap-2" aria-label="EDM VERSEX home">
      <span class="inline-flex h-9 w-9 rounded-full bg-gradient-to-tr from-emerald-500 via-sky-500 to-fuchsia-500 items-center justify-center shadow-lg shadow-emerald-500/40">
        <span class="h-3 w-3 rounded-full bg-slate-950"></span>
      </span>
      <span class="flex flex-col leading-tight">
        <span class="text-xs font-semibold tracking-[0.22em] uppercase text-emerald-400">EDM VERSEX</span>
        <span class="text-[11px] text-slate-300/90">Global EDM snapshot, once a day</span>
      </span>
    </a>
    <nav class="ml-auto hidden sm:flex items-center gap-1.5 text-[11px]">
      <a href="#top50" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Top 50</a>
      <a href="#latest" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Latest 20</a>
      <a href="#news" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">News</a>
      <a href="#top-liked" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Top Songs</a>
      <a href="#contact" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Contact</a>
    </nav>
  </section>

  <section class="mx-auto max-w-5xl px-4 pb-3">
    <section class="rounded-2xl bg-slate-900/95 border border-slate-800 p-2 flex items-center justify-center">
      <ins class="adsbygoogle"
           style="display:block; width:100%;"
           data-ad-client="ca-pub-4201977277980522"
           data-ad-slot="1234567890"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
        try {(adsbygoogle = window.adsbygoogle || []).push({});} catch (e) {}
      </script>
    </section>
  </section>
</header>

<main id="main" class="relative z-10 mx-auto max-w-5xl px-4 pt-4 pb-28 space-y-6">

  <section id="top" class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-6 lg:p-7 relative overflow-hidden">
    <section class="absolute inset-0 pointer-events-none opacity-30">
      <section class="absolute -top-10 -left-10 w-40 h-40 rounded-full bg-emerald-500 blur-3xl"></section>
      <section class="absolute -bottom-16 -right-16 w-56 h-56 rounded-full bg-sky-500 blur-3xl"></section>
    </section>

    <section class="relative flex flex-col gap-5">
      <section class="space-y-3">
        <p class="text-[11px] font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Daily electronic pulse
        </p>
        <h1 class="text-xl sm:text-2xl lg:text-3xl font-semibold text-slate-50">
          Global EDM, house and trance in one immersive daily snapshot.
        </h1>
        <p class="text-sm sm:text-[15px] text-slate-300/90">
          Every day EDM VERSEX takes a fresh look at public SoundCloud activity across key club styles,
          tracking which tracks rise, which artists keep momentum and how the mood of the scene shifts.
        </p>
      </section>

      <section class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-[11px] sm:text-xs">
        <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
          <p class="text-slate-400 uppercase tracking-[0.18em]">Tracks in snapshot</p>
          <p class="mt-1 text-slate-50 text-base font-semibold" id="stat-track-count">â€“</p>
          <p class="mt-1 text-slate-400">Number of tracks analysed today.</p>
        </section>
        <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
          <p class="text-slate-400 uppercase tracking-[0.18em]">Most active style</p>
          <p class="mt-1 text-slate-50 text-base font-semibold" id="stat-dominant-genre">â€“</p>
          <p class="mt-1 text-slate-400">Dominant genre in the current Top 50.</p>
        </section>
        <section class="rounded-2xl bg-slate-900/80 border border-slate-700/80 px-3 py-2">
          <p class="text-slate-400 uppercase tracking-[0.18em]">Last update</p>
          <p class="mt-1 text-slate-50 text-base font-semibold" id="stat-last-updated">â€“</p>
          <p class="mt-1 text-slate-400">Local time of the latest snapshot.</p>
        </section>
      </section>

      <section class="rounded-2xl bg-slate-950/80 border border-slate-800 p-3 flex flex-col gap-3 text-[11px] sm:text-xs">
        <section class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <section>
            <p class="uppercase tracking-[0.2em] text-emerald-400">Track of the moment</p>
            <p class="mt-1 text-slate-50 font-semibold truncate" id="stat-top-track">â€“</p>
            <p class="text-slate-400" id="stat-top-artist">â€“</p>
          </section>
          <section class="flex flex-col items-start sm:items-end gap-1 text-slate-400">
            <p id="snapshot-meta" class="text-[10px]"></p>
            <p class="text-[10px]" id="snapshot-warning"></p>
          </section>
        </section>
      </section>
    </section>
  </section>

  <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <section id="top50" class="lg:col-span-2 rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-5 space-y-3">
      <header class="space-y-1">
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Global Top 50
        </h2>
        <p class="text-xs sm:text-[13px] text-slate-300/90">
          Tracks are ordered by play count and recency across popular EDM, house and trance tags on SoundCloud.
        </p>
      </header>

      <section class="flex flex-wrap gap-1.5 text-[11px] mt-1">
        <button class="genre-filter px-3 py-1.5 rounded-full bg-emerald-500 text-slate-950 font-semibold" data-genre="all">
          All
        </button>
        <button class="genre-filter px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80" data-genre="house">
          House
        </button>
        <button class="genre-filter px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80" data-genre="trance">
          Trance
        </button>
        <button class="genre-filter px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80" data-genre="techno">
          Techno
        </button>
        <button class="genre-filter px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80" data-genre="other">
          Other
        </button>
      </section>

      <section id="top50-list" class="mt-2 rounded-2xl bg-slate-950/80 border border-slate-800/90 max-h-[420px] overflow-y-auto" aria-live="polite">
        <section class="p-3 space-y-2" id="top50-skeleton">
          <p class="text-[11px] text-slate-400">Loading todayâ€™s Top 50 snapshotâ€¦</p>
          <section class="animate-pulse space-y-2">
            <section class="h-10 rounded-xl bg-slate-800/60"></section>
            <section class="h-10 rounded-xl bg-slate-800/60"></section>
            <section class="h-10 rounded-xl bg-slate-800/60"></section>
          </section>
        </section>
      </section>
    </section>

    <section id="latest" class="rounded-3xl bg-edm-panel border border-slate-800 p-4 sm:p-5 space-y-3">
      <header class="space-y-1">
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Latest 20 uploads
        </h2>
        <p class="text-xs sm:text-[13px] text-slate-300/90">
          Fresh public uploads inside the same genres, sorted by upload time.
        </p>
      </header>

      <section id="latest-list" class="rounded-2xl bg-slate-950/80 border border-slate-800/90 max-h-[420px] overflow-y-auto" aria-live="polite">
        <section class="p-3 space-y-2" id="latest-skeleton">
          <p class="text-[11px] text-slate-400">Loading todayâ€™s freshest uploadsâ€¦</p>
          <section class="animate-pulse space-y-2">
            <section class="h-12 rounded-xl bg-slate-800/60"></section>
            <section class="h-12 rounded-xl bg-slate-800/60"></section>
          </section>
        </section>
      </section>
    </section>
  </section>

  <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <section id="news" class="lg:col-span-2 rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-5 space-y-3">
      <header class="space-y-1">
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          EDM news & editorials
        </h2>
        <p class="text-xs sm:text-[13px] text-slate-300/90">
          Headlines pulled from established EDM publications and curated into a quick daily overview.
        </p>
      </header>

      <section id="news-list" class="space-y-2 max-h-[380px] overflow-y-auto" aria-live="polite">
        <section class="p-3 space-y-2" id="news-skeleton">
          <p class="text-[11px] text-slate-400">Collecting fresh EDM headlinesâ€¦</p>
          <section class="animate-pulse space-y-2">
            <section class="h-12 rounded-xl bg-slate-800/60"></section>
            <section class="h-12 rounded-xl bg-slate-800/60"></section>
          </section>
        </section>
      </section>
    </section>

    <section id="top-liked" class="rounded-3xl bg-edm-panel border border-slate-800 p-4 sm:p-5 space-y-3">
      <header class="space-y-1">
        <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Top songs by listeners
        </h2>
        <p class="text-xs sm:text-[13px] text-slate-300/90">
          Every heart adds a vote. This list highlights the tracks that visitors are reacting to right now.
        </p>
      </header>

      <section id="top-liked-list" class="rounded-2xl bg-slate-950/80 border border-slate-800/90 max-h-[380px] overflow-y-auto" aria-live="polite">
        <section class="p-3 space-y-2" id="top-liked-skeleton">
          <p class="text-[11px] text-slate-400">Waiting for listener votesâ€¦</p>
        </section>
      </section>

      <section class="mt-2 text-[10px] text-slate-400">
        <p>Votes are anonymous and stored only as simple counters, with no user profiles attached.</p>
      </section>
    </section>
  </section>

  <section id="about" class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-5 space-y-3">
    <header>
      <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
        About EDM VERSEX
      </h2>
    </header>
    <section class="space-y-2 text-sm sm:text-[15px] leading-relaxed text-slate-300/90">
      <p>
        EDM VERSEX is a compact destination for listeners, DJs and producers who want to feel where global club music
        is heading without scrolling endlessly through feeds. The focus stays on the intersection of melodic energy,
        dancefloor power and underground experimentation.
      </p>
      <p>
        The charts are built on public SoundCloud data from key genres and tags. Each day the snapshot is refreshed once,
        keeping the experience fast and stable while respecting API rate limits. If a live update fails, the hub falls back
        to the last valid snapshot so the page never feels broken.
      </p>
      <p>
        Alongside data driven lists, the news section and the listener voting area introduce a human voice. Headlines
        bring context from the wider EDM ecosystem, while votes highlight which tracks actually resonate with visitors.
      </p>
    </section>
  </section>

  <section id="contact" class="rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-5 space-y-3">
    <header>
      <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
        Contact
      </h2>
    </header>
    <section class="space-y-2 text-sm sm:text-[15px] leading-relaxed text-slate-300/90">
      <p>
        For label features, promo submissions, partnership ideas or feedback about the hub, reach out by email.
      </p>
      <p class="font-semibold">
        info@edmversex.com
      </p>
    </section>

    <section class="mt-3 rounded-2xl bg-slate-950/80 border border-slate-800 p-3 text-[11px] text-slate-400">
      <p>
        Display ads on this site appear only next to rich editorial content or long-form lists, not on empty or purely
        functional views, in line with AdSense policies.
      </p>
    </section>
  </section>

  <section class="rounded-3xl bg-slate-950/95 border border-slate-800 p-3">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-4201977277980522"
         data-ad-slot="9876543210"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
      try {(adsbygoogle = window.adsbygoogle || []).push({});} catch (e) {}
    </script>
  </section>

</main>

<footer class="fixed bottom-0 left-0 right-0 z-20">
  <section class="mx-auto max-w-5xl px-4 pb-[env(safe-area-inset-bottom)]">
    <section class="rounded-2xl bg-slate-950/95 border border-slate-800/90 backdrop-blur-xl shadow-edm-soft px-3 py-2 flex flex-col gap-1">
      <section class="flex items-center justify-between text-[10px] text-slate-400">
        <p>Â© <span id="year"></span> EDM VERSEX</p>
        <a href="#top" class="underline">Back to top</a>
      </section>
      <section class="flex items-center justify-between text-[11px] text-slate-300">
        <nav class="flex items-center gap-1.5">
          <a href="#top50" class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">ðŸ“ˆ</span><span>Top 50</span>
          </a>
          <a href="#latest" class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">ðŸ†•</span><span>Latest</span>
          </a>
          <a href="#news" class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">ðŸ“°</span><span>News</span>
          </a>
        </nav>
        <p class="text-[10px] text-slate-500">Daily snapshot based on public SoundCloud data.</p>
      </section>
    </section>
  </section>
</footer>

<noscript>
  <section class="mx-auto max-w-5xl mt-4 px-4">
    <section class="rounded-2xl bg-red-900/80 text-red-100 p-3 text-xs">
      JavaScript is disabled. Charts, news and voting require JavaScript to be enabled.
    </section>
  </section>
</noscript>

<section id="player-overlay" class="fixed inset-0 z-40 hidden items-end justify-center bg-slate-950/80 backdrop-blur-md">
  <section class="w-full max-w-xl mx-auto rounded-t-3xl bg-slate-950 border-t border-slate-800 shadow-edm-soft">
    <section class="flex items-center justify-between px-4 pt-3 pb-2">
      <p class="text-xs text-slate-300" id="player-title">Now playing</p>
      <button id="player-close" class="text-xs text-slate-400 px-2 py-1 rounded-full bg-slate-900 border border-slate-700">
        Close
      </button>
    </section>
    <section id="player-frame-box" class="px-4 pb-4">
      <section class="h-52 rounded-2xl bg-slate-900 border border-slate-800 flex items-center justify-center text-[11px] text-slate-400">
        Loading playerâ€¦
      </section>
    </section>
  </section>
</section>

<script>
  (function () {
    "use strict";

    const API_BASE = "/api";
    const ENDPOINTS = {
      snapshot: API_BASE + "/snapshot",
      vote: API_BASE + "/vote",
      topVoted: API_BASE + "/top-voted"
    };

    const top50Container = document.getElementById("top50-list");
    const top50Skeleton = document.getElementById("top50-skeleton");
    const latestContainer = document.getElementById("latest-list");
    const latestSkeleton = document.getElementById("latest-skeleton");
    const newsContainer = document.getElementById("news-list");
    const newsSkeleton = document.getElementById("news-skeleton");
    const topLikedContainer = document.getElementById("top-liked-list");
    const topLikedSkeleton = document.getElementById("top-liked-skeleton");

    const statTrackCount = document.getElementById("stat-track-count");
    const statDominantGenre = document.getElementById("stat-dominant-genre");
    const statLastUpdated = document.getElementById("stat-last-updated");
    const statTopTrack = document.getElementById("stat-top-track");
    const statTopArtist = document.getElementById("stat-top-artist");
    const snapshotMeta = document.getElementById("snapshot-meta");
    const snapshotWarning = document.getElementById("snapshot-warning");

    const playerOverlay = document.getElementById("player-overlay");
    const playerFrameBox = document.getElementById("player-frame-box");
    const playerTitle = document.getElementById("player-title");
    const playerClose = document.getElementById("player-close");

    const yearSpan = document.getElementById("year");
    if (yearSpan) {
      yearSpan.textContent = new Date().getFullYear();
    }

    let top50Data = [];
    let latestData = [];
    let newsData = [];
    let topLikedData = [];
    let currentGenreFilter = "all";

    function formatNumber(n) {
      if (typeof n !== "number") n = Number(n || 0);
      if (Number.isNaN(n)) return "-";
      if (n >= 1_000_000) return (n / 1_000_000).toFixed(1) + "M";
      if (n >= 1_000) return (n / 1_000).toFixed(1) + "k";
      return n.toString();
    }

    function normalizeGenreKey(g) {
      const v = String(g || "").toLowerCase();
      if (v.includes("house")) return "house";
      if (v.includes("trance")) return "trance";
      if (v.includes("techno")) return "techno";
      if (v.includes("drum")) return "drum & bass";
      return "other";
    }

    async function fetchJSON(url, options) {
      const res = await fetch(url, options || { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      return res.json();
    }

    function renderStats(stats, meta) {
      if (!stats) return;
      statTrackCount.textContent = stats.trackCount != null ? stats.trackCount : "â€“";
      statDominantGenre.textContent = stats.dominantGenre || "MIXED";
      const generated = meta && meta.generatedAt ? new Date(meta.generatedAt) : null;
      if (generated) {
        statLastUpdated.textContent = generated.toLocaleTimeString();
        snapshotMeta.textContent = "Snapshot generated at " + generated.toLocaleString();
      } else {
        snapshotMeta.textContent = "";
      }
      if (stats.topTrackTitle) {
        statTopTrack.textContent = stats.topTrackTitle;
      }
      if (stats.topTrackArtist) {
        statTopArtist.textContent = stats.topTrackArtist;
      }
      if (meta && meta.warning) {
        snapshotWarning.textContent = meta.warning;
      } else {
        snapshotWarning.textContent = "";
      }
    }

    function renderTop50() {
      if (!top50Container) return;
      top50Container.setAttribute("aria-busy", "true");
      if (top50Skeleton) top50Skeleton.style.display = "none";

      const html = top50Data.map(function (track) {
        const norm = normalizeGenreKey(track.genre);
        const highlight = currentGenreFilter === "all" || currentGenreFilter === norm;
        const wrapperClass = highlight
          ? "border-emerald-500/60 bg-slate-900/90"
          : "border-slate-800 bg-slate-950/80 opacity-80";

        return (
          '<article class="m-1 rounded-2xl border ' + wrapperClass + ' p-2.5 flex items-center gap-3 text-[11px] sm:text-[13px]" data-track-id="' + String(track.id) + '">' +
          '  <section class="flex flex-col items-center justify-center w-7 shrink-0">' +
          '    <span class="text-xs font-semibold text-slate-300">#' + String(track.rank || "?") + "</span>" +
          '  </section>' +
          '  <section class="flex-1 min-w-0 flex items-center gap-3">' +
          '    <section class="h-10 w-10 rounded-xl overflow-hidden bg-slate-900 shrink-0">' +
          (track.artwork
            ? '<img src="' + track.artwork + '" alt="" class="h-full w-full object-cover" loading="lazy">'
            : '<section class="h-full w-full flex items-center justify-center text-[10px] text-slate-500">EDM</section>') +
          "    </section>" +
          '    <section class="min-w-0">' +
          '      <p class="text-[10px] uppercase tracking-[0.2em] text-slate-400">' + (track.genre || "EDM") + "</p>" +
          '      <p class="truncate text-slate-50 font-semibold">' + (track.title || "Untitled track") + "</p>" +
          '      <p class="text-[11px] text-slate-400 truncate">by ' + (track.artist || "Unknown artist") + "</p>" +
          "    </section>" +
          "  </section>" +
          '  <section class="flex flex-col items-end text-right gap-1 text-[10px] text-slate-400 shrink-0">' +
          '    <span>ðŸŽ§ ' + formatNumber(track.plays || 0) + " plays</span>" +
          '    <section class="flex items-center gap-1">' +
          '      <button class="play-btn px-2 py-0.5 rounded-full bg-slate-900 border border-emerald-500/80 text-emerald-400" data-url="' + (track.url || "") + '" data-title="' + (track.title || "") + '">' +
          "        Play" +
          "      </button>" +
          '      <button class="vote-btn px-2 py-0.5 rounded-full bg-slate-900/80 border border-slate-700/80 text-slate-200" data-track-id="' + String(track.id) + '">' +
          "        â™¥" +
          "      </button>" +
          "    </section>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      top50Container.innerHTML = html;
      top50Container.setAttribute("aria-busy", "false");
    }

    function renderLatest() {
      if (!latestContainer) return;
      latestContainer.setAttribute("aria-busy", "true");
      if (latestSkeleton) latestSkeleton.style.display = "none";

      if (!latestData || latestData.length === 0) {
        latestContainer.innerHTML = '<section class="p-3 text-[11px] text-slate-400">No recent uploads in this snapshot.</section>';
        latestContainer.setAttribute("aria-busy", "false");
        return;
      }

      const html = latestData.map(function (rel) {
        return (
          '<article class="m-1 rounded-2xl border border-slate-800 bg-slate-950/80 p-3 flex items-center gap-3 text-[11px] sm:text-[13px]" data-track-id="' + String(rel.id) + '">' +
          '  <section class="h-10 w-10 rounded-xl overflow-hidden bg-slate-900 shrink-0">' +
          (rel.artwork
            ? '<img src="' + rel.artwork + '" alt="" class="h-full w-full object-cover" loading="lazy">'
            : '<section class="h-full w-full flex items-center justify-center text-[10px] text-slate-500">NEW</section>') +
          "  </section>" +
          '  <section class="flex-1 min-w-0">' +
          '    <p class="text-[10px] uppercase tracking-[0.2em] text-sky-400">' + (rel.genre || "EDM") + "</p>" +
          '    <p class="truncate text-slate-50 font-semibold">' + (rel.title || "Untitled track") + "</p>" +
          '    <p class="text-[11px] text-slate-400 truncate">by ' + (rel.artist || "Unknown artist") + "</p>" +
          '    <p class="text-[10px] text-slate-500 mt-0.5">' + (rel.createdAt || "") + "</p>" +
          "  </section>" +
          '  <section class="flex flex-col items-end text-right gap-1 text-[10px] text-slate-400 shrink-0">' +
          '    <button class="play-btn px-2 py-0.5 rounded-full bg-slate-900 border border-emerald-500/80 text-emerald-400" data-url="' + (rel.url || "") + '" data-title="' + (rel.title || "") + '">' +
          "      Play" +
          "    </button>" +
          '    <button class="vote-btn px-2 py-0.5 rounded-full bg-slate-900/80 border border-slate-700/80 text-slate-200" data-track-id="' + String(rel.id) + '">' +
          "      â™¥" +
          "    </button>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      latestContainer.innerHTML = html;
      latestContainer.setAttribute("aria-busy", "false");
    }

    function renderNews() {
      if (!newsContainer) return;
      newsContainer.setAttribute("aria-busy", "true");
      if (newsSkeleton) newsSkeleton.style.display = "none";

      if (!newsData || newsData.length === 0) {
        newsContainer.innerHTML = '<section class="p-3 text-[11px] text-slate-400">No news available for this snapshot.</section>';
        newsContainer.setAttribute("aria-busy", "false");
        return;
      }

      const html = newsData.map(function (item) {
        return (
          '<article class="rounded-2xl border border-slate-800 bg-slate-950/80 p-3 text-[11px] sm:text-[13px]">' +
          '  <a href="' + (item.url || "#") + '" target="_blank" rel="noopener noreferrer" class="block group">' +
          '    <p class="text-[10px] uppercase tracking-[0.2em] text-emerald-400">' + (item.source || "EDM news") + "</p>" +
          '    <p class="mt-1 text-slate-50 font-semibold group-hover:text-emerald-400">' + (item.title || "Untitled article") + "</p>" +
          '    <p class="mt-1 text-[11px] text-slate-300/90">' + (item.summary || "") + "</p>" +
          '    <p class="mt-1 text-[10px] text-slate-500">' + (item.publishedAt || "") + "</p>" +
          "  </a>" +
          "</article>"
        );
      }).join("");

      newsContainer.innerHTML = html;
      newsContainer.setAttribute("aria-busy", "false");
    }

    function renderTopLiked() {
      if (!topLikedContainer) return;
      topLikedContainer.setAttribute("aria-busy", "true");
      if (topLikedSkeleton) topLikedSkeleton.style.display = "none";

      if (!topLikedData || topLikedData.length === 0) {
        topLikedContainer.innerHTML = '<section class="p-3 text-[11px] text-slate-400">No listener votes yet. Tap hearts on tracks to shape this list.</section>';
        topLikedContainer.setAttribute("aria-busy", "false");
        return;
      }

      const html = topLikedData.map(function (track, idx) {
        return (
          '<article class="m-1 rounded-2xl border border-emerald-500/70 bg-slate-900/90 p-3 flex items-center gap-3 text-[11px] sm:text-[13px]">' +
          '  <section class="flex flex-col items-center justify-center w-6 shrink-0">' +
          '    <span class="text-xs font-semibold text-emerald-400">#' + String(idx + 1) + "</span>" +
          "  </section>" +
          '  <section class="h-10 w-10 rounded-xl overflow-hidden bg-slate-900 shrink-0">' +
          (track.artwork
            ? '<img src="' + track.artwork + '" alt="" class="h-full w-full object-cover" loading="lazy">'
            : '<section class="h-full w-full flex items-center justify-center text-[10px] text-slate-500">FAN</section>') +
          "  </section>" +
          '  <section class="flex-1 min-w-0">' +
          '    <p class="text-[10px] uppercase tracking-[0.2em] text-sky-400">' + (track.genre || "EDM") + "</p>" +
          '    <p class="truncate text-slate-50 font-semibold">' + (track.title || "Untitled track") + "</p>" +
          '    <p class="text-[11px] text-slate-400 truncate">by ' + (track.artist || "Unknown artist") + "</p>" +
          "  </section>" +
          '  <section class="flex flex-col items-end text-right gap-1 text-[10px] text-slate-400 shrink-0">' +
          '    <span>â™¥ ' + formatNumber(track.votes || 0) + " votes</span>" +
          '    <button class="play-btn px-2 py-0.5 rounded-full bg-slate-900 border border-emerald-500/80 text-emerald-400" data-url="' + (track.url || "") + '" data-title="' + (track.title || "") + '">' +
          "      Play" +
          "    </button>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      topLikedContainer.innerHTML = html;
      topLikedContainer.setAttribute("aria-busy", "false");
    }

    function openPlayer(url, title) {
      if (!url || !playerOverlay || !playerFrameBox) return;
      const src =
        "https://w.soundcloud.com/player/?url=" +
        encodeURIComponent(url) +
        "&color=%2322c55e&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true";

      playerFrameBox.innerHTML =
        '<iframe title="SoundCloud player" width="100%" height="220" scrolling="no" frameborder="no" allow="autoplay" src="' +
        src +
        '"></iframe>';

      if (playerTitle) {
        playerTitle.textContent = title || "Now playing";
      }

      playerOverlay.classList.remove("hidden");
      playerOverlay.classList.add("flex");
    }

    function closePlayer() {
      if (!playerOverlay || !playerFrameBox) return;
      playerOverlay.classList.add("hidden");
      playerOverlay.classList.remove("flex");
      playerFrameBox.innerHTML =
        '<section class="h-52 rounded-2xl bg-slate-900 border border-slate-800 flex items-center justify-center text-[11px] text-slate-400">Player closed</section>';
    }

    function attachGlobalHandlers() {
      const filterButtons = document.querySelectorAll(".genre-filter");
      filterButtons.forEach(function (btn) {
        btn.addEventListener("click", function () {
          const genre = btn.getAttribute("data-genre") || "all";
          currentGenreFilter = genre;

          filterButtons.forEach(function (b) {
            b.classList.remove("bg-emerald-500", "text-slate-950");
            b.classList.add("bg-slate-950/80", "border-slate-700/80");
          });
          btn.classList.remove("bg-slate-950/80");
          btn.classList.add("bg-emerald-500", "text-slate-950");

          renderTop50();
        });
      });

      if (top50Container) {
        top50Container.addEventListener("click", function (e) {
          const btnPlay = e.target.closest(".play-btn");
          const btnVote = e.target.closest(".vote-btn");
          if (btnPlay) {
            const url = btnPlay.getAttribute("data-url");
            const title = btnPlay.getAttribute("data-title");
            openPlayer(url, title);
          } else if (btnVote) {
            const id = btnVote.getAttribute("data-track-id");
            sendVote(id);
          }
        });
      }

      if (latestContainer) {
        latestContainer.addEventListener("click", function (e) {
          const btnPlay = e.target.closest(".play-btn");
          const btnVote = e.target.closest(".vote-btn");
          if (btnPlay) {
            const url = btnPlay.getAttribute("data-url");
            const title = btnPlay.getAttribute("data-title");
            openPlayer(url, title);
          } else if (btnVote) {
            const id = btnVote.getAttribute("data-track-id");
            sendVote(id);
          }
        });
      }

      if (topLikedContainer) {
        topLikedContainer.addEventListener("click", function (e) {
          const btnPlay = e.target.closest(".play-btn");
          if (btnPlay) {
            const url = btnPlay.getAttribute("data-url");
            const title = btnPlay.getAttribute("data-title");
            openPlayer(url, title);
          }
        });
      }

      if (playerClose) {
        playerClose.addEventListener("click", closePlayer);
      }
      if (playerOverlay) {
        playerOverlay.addEventListener("click", function (e) {
          if (e.target === playerOverlay) closePlayer();
        });
      }
    }

    async function sendVote(id) {
      if (!id) return;
      try {
        await fetchJSON(ENDPOINTS.vote, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ trackId: id })
        });
        loadTopVoted();
      } catch (e) {}
    }

    async function loadSnapshot() {
      try {
        const data = await fetchJSON(ENDPOINTS.snapshot);
        top50Data = Array.isArray(data.top50) ? data.top50 : [];
        latestData = Array.isArray(data.latest) ? data.latest : [];
        newsData = Array.isArray(data.news) ? data.news : [];
        renderStats(data.stats || null, data.meta || null);
        renderTop50();
        renderLatest();
        renderNews();
      } catch (err) {
        if (top50Container && top50Skeleton) {
          top50Skeleton.innerHTML = '<p class="text-[11px] text-red-400">Failed to load snapshot.</p>';
        }
        if (latestContainer && latestSkeleton) {
          latestSkeleton.innerHTML = '<p class="text-[11px] text-red-400">Failed to load latest uploads.</p>';
        }
        if (newsContainer && newsSkeleton) {
          newsSkeleton.innerHTML = '<p class="text-[11px] text-red-400">Failed to load news.</p>';
        }
      }
    }

    async function loadTopVoted() {
      try {
        const data = await fetchJSON(ENDPOINTS.topVoted);
        topLikedData = Array.isArray(data.tracks) ? data.tracks : [];
        renderTopLiked();
      } catch (e) {
        if (topLikedContainer && topLikedSkeleton) {
          topLikedSkeleton.innerHTML = '<p class="text-[11px] text-red-400">Failed to load listener favourites.</p>';
        }
      }
    }

    function initWaves() {
      const canvas = document.getElementById("wave-canvas");
      if (!canvas) return;
      const ctx = canvas.getContext("2d");
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener("resize", resize);

      let t = 0;
      function draw() {
        if (!ctx) return;
        const w = canvas.width;
        const h = canvas.height;
        ctx.clearRect(0, 0, w, h);
        ctx.lineWidth = 1.2;

        const layers = [
          { color: "rgba(34,197,94,0.40)", amp: 32, speed: 0.0018 },
          { color: "rgba(56,189,248,0.35)", amp: 46, speed: 0.0012 },
          { color: "rgba(244,114,182,0.30)", amp: 58, speed: 0.0009 }
        ];

        layers.forEach(function (g, i) {
          ctx.beginPath();
          ctx.strokeStyle = g.color;
          const yBase = h * (0.3 + 0.15 * i);
          for (let x = 0; x <= w; x += 8) {
            const y =
              yBase +
              Math.sin(x * 0.01 + t * g.speed * 260) * g.amp *
              Math.cos(t * g.speed * 120 + i);
            if (x === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();
        });

        t++;
        requestAnimationFrame(draw);
      }
      draw();
    }

    attachGlobalHandlers();
    initWaves();
    loadSnapshot();
    loadTopVoted();
  })();
</script>

</body>
</html>
