<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EDM VERSEX | Global EDM Charts, New Tracks & Fan Votes</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <meta name="description" content="EDM VERSEX is a living EDM dashboard: live SoundCloud-powered charts, latest tracks, curated news and fan-voted favourites in one immersive page.">
  <meta name="keywords" content="EDM, electronic dance music, house, trance, techno, SoundCloud charts, latest tracks, DJ, producer, club music">
  <meta name="author" content="EDM VERSEX">

  <meta property="og:title" content="EDM VERSEX | Global EDM Charts & Latest Tracks">
  <meta property="og:description" content="Scan the sound of clubs and festivals with global Top 50, fresh uploads and fan-voted favourites.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://edmversex.com/">
  <meta property="og:image" content="https://edmversex.com/assets/edmversex-cover.jpg">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="EDM VERSEX | Global EDM Charts & Latest Tracks">
  <meta name="twitter:description" content="An immersive EDM hub built on SoundCloud data, news feeds and fan voting.">

  <link rel="icon" type="image/png" sizes="32x32" href="assets/icon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icon-180.png">

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js?client=ca-pub-4201977277980522" crossorigin="anonymous"></script>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1KFLYZ78XS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-1KFLYZ78XS");
  </script>

  <!-- Tailwind CDN (ok for this project, despite console warning) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "edm-bg": "#020617",
            "edm-panel": "rgba(15,23,42,0.98)",
            "edm-glass": "rgba(15,23,42,0.85)",
            "edm-accent": "#22c55e",
            "edm-highlight": "#38bdf8"
          },
          boxShadow: {
            "edm-soft": "0 24px 70px rgba(15,23,42,0.9)"
          }
        }
      }
    };
  </script>

  <style>
    html,
    body {
      max-width: 100%;
      overflow-x: hidden;
      scroll-behavior: smooth;
      background: radial-gradient(circle at top, #0f172a 0, #020617 40%, #000 100%);
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    :focus-visible {
      outline: 2px solid #22c55e;
      outline-offset: 3px;
    }

    #bg-waves {
      position: fixed;
      inset: -40px 0 0 0;
      pointer-events: none;
      opacity: .6;
      mix-blend-mode: screen;
      z-index: 0;
    }

    @media (min-width: 768px) {
      #main-layout {
        display: grid;
        grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.1fr);
        gap: 1rem;
      }
    }

    @media (max-width: 640px) {
      .mobile-full-width {
        margin-left: -1rem;
        margin-right: -1rem;
        border-radius: 0;
      }
    }
  </style>
</head>
<body class="min-h-screen text-slate-50 antialiased bg-edm-bg relative">

<canvas id="bg-waves"></canvas>

<a href="#main-content"
   class="sr-only focus:not-sr-only focus:fixed focus:z-50 focus:top-3 focus:left-3 focus:px-4 focus:py-2 focus:rounded-full focus:bg-slate-900 focus:text-emerald-400">
  Skip to main content
</a>

<!-- HEADER -->
<header class="sticky top-0 z-30 backdrop-blur-2xl bg-slate-950/90 border-b border-slate-800/80">
  <nav class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
    <a href="#top" class="flex items-center gap-2" aria-label="EDM VERSEX home">
      <span class="inline-flex h-9 w-9 rounded-full bg-gradient-to-tr from-emerald-500 via-sky-500 to-fuchsia-500 items-center justify-center shadow-lg shadow-emerald-500/40">
        <span class="h-3 w-3 rounded-full bg-slate-950"></span>
      </span>
      <span class="flex flex-col leading-tight">
        <span class="text-xs font-semibold tracking-[0.22em] uppercase text-emerald-400">EDM VERSEX</span>
        <span class="text-[11px] text-slate-300/90">Global EDM dashboard</span>
      </span>
    </a>

    <section class="ml-auto flex items-center gap-2 text-[11px]">
      <a href="#top50" class="hidden sm:inline-flex px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Top 50</a>
      <a href="#latest" class="hidden sm:inline-flex px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Latest</a>
      <a href="#news" class="hidden sm:inline-flex px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">News</a>
      <a href="#fan" class="hidden sm:inline-flex px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">Fan votes</a>
      <a href="#about" class="hidden sm:inline-flex px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/80">About</a>
    </section>
  </nav>

  <!-- TOP BANNER AD -->
  <section class="mx-auto max-w-6xl px-4 pb-3">
    <section class="rounded-2xl border border-slate-800 bg-slate-900/90 p-2 flex items-center justify-center mobile-full-width">
      <ins class="adsbygoogle"
           style="display:block;width:100%;min-height:60px"
           data-ad-client="ca-pub-4201977277980522"
           data-ad-slot="1234567890"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
        window.addEventListener("load", function () {
          try {
            (adsbygoogle = window.adsbygoogle || []).push({});
          } catch (e) {
            console.warn("AdSense banner error", e);
          }
        });
      </script>
    </section>
  </section>
</header>

<main id="main-content" class="mx-auto max-w-6xl px-4 pt-4 pb-32 space-y-4 relative z-10">

  <!-- HERO + SNAPSHOT -->
  <section id="top" class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-6 space-y-4 mobile-full-width">
    <section class="flex flex-col gap-5">
      <section class="space-y-3">
        <p class="text-[11px] font-semibold tracking-[0.25em] uppercase text-emerald-400">
          Today‚Äôs perspective
        </p>
        <h1 class="text-xl sm:text-2xl lg:text-3xl font-semibold">
          Live window into global EDM: SoundCloud charts, fresh uploads, news and fan favourites.
        </h1>
        <p class="text-sm sm:text-[15px] text-slate-300/90">
          EDM VERSEX takes a daily snapshot of the SoundCloud universe across house, trance, techno and related styles.
          Tracks are ordered by real play counts and upload time, then combined with headlines and community voting to
          show what is actually shaping dancefloors.
        </p>
      </section>

      <section class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-[11px] sm:text-xs">
        <section class="rounded-2xl bg-slate-950/80 border border-slate-800 px-3 py-2">
          <p class="uppercase tracking-[0.2em] text-slate-400">Tracked today</p>
          <p id="stat-track-count" class="mt-1 text-slate-50 font-semibold text-sm">‚Äì</p>
          <p class="mt-1 text-slate-400">Tracks scanned in the current Top chart.</p>
        </section>
        <section class="rounded-2xl bg-slate-950/80 border border-slate-800 px-3 py-2">
          <p class="uppercase tracking-[0.2em] text-slate-400">Snapshot time</p>
          <p id="stat-last-updated" class="mt-1 text-slate-50 font-semibold text-sm">‚Äì</p>
          <p class="mt-1 text-slate-400">Local time of the latest daily update.</p>
        </section>
        <section class="rounded-2xl bg-slate-950/80 border border-slate-800 px-3 py-2">
          <p class="uppercase tracking-[0.2em] text-slate-400">Dominant flavour</p>
          <p id="stat-dominant-genre" class="mt-1 text-slate-50 font-semibold text-sm">‚Äì</p>
          <p class="mt-1 text-slate-400">Genre that appears most in today‚Äôs Top 50.</p>
        </section>
      </section>
    </section>
  </section>

  <section id="main-layout" class="space-y-4 md:space-y-0">

    <!-- LEFT: TOP 50 + LATEST -->
    <section class="space-y-4 md:pr-1">

      <!-- GENRE FILTER + TOP 50 -->
      <section id="top50" class="rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-5 space-y-3 mobile-full-width md:mobile-full-width-none">
        <header class="flex flex-col gap-2">
          <section class="flex items-center justify-between gap-2">
            <section>
              <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
                Global Top 50
              </h2>
              <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
                Tracks ordered by SoundCloud plays and filtered to the tempo and mood of club music.
                Tap a track to listen inside the page or give it a fan vote.
              </p>
            </section>
          </section>
          <section class="flex flex-wrap gap-1.5 text-[11px] mt-2">
            <button data-genre-filter="all" class="genre-filter-btn px-3 py-1.5 rounded-full bg-emerald-500 text-slate-950 font-semibold">
              All
            </button>
            <button data-genre-filter="house" class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80">
              House
            </button>
            <button data-genre-filter="trance" class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80">
              Trance
            </button>
            <button data-genre-filter="techno" class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80">
              Techno
            </button>
            <button data-genre-filter="other" class="genre-filter-btn px-3 py-1.5 rounded-full bg-slate-950/80 border border-slate-700/80">
              Other
            </button>
          </section>
        </header>

        <section id="top50-list" class="mt-2 max-h-[440px] overflow-y-auto rounded-2xl bg-slate-950/80 border border-slate-800/90"
                 aria-live="polite" aria-busy="false">
          <section id="top50-skeleton" class="p-3 space-y-2">
            <p class="text-[11px] text-slate-400">Loading today‚Äôs Top 50‚Ä¶</p>
            <section class="space-y-2 animate-pulse">
              <section class="h-11 rounded-xl bg-slate-800/60"></section>
              <section class="h-11 rounded-xl bg-slate-800/60"></section>
              <section class="h-11 rounded-xl bg-slate-800/60"></section>
            </section>
          </section>
        </section>
      </section>

      <!-- LATEST 20 -->
      <section id="latest" class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-5 space-y-3 mobile-full-width md:mobile-full-width-none">
        <header>
          <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
            Latest 20 uploads
          </h2>
          <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
            A quick view of new tracks appearing in the same SoundCloud universe.
            These are the cuts you can be early on.
          </p>
        </header>

        <section id="latest-list" class="mt-2 max-h-[360px] overflow-y-auto rounded-2xl bg-slate-950/80 border border-slate-800/90"
                 aria-live="polite" aria-busy="false">
          <section id="latest-skeleton" class="p-3 space-y-2">
            <p class="text-[11px] text-slate-400">Collecting the newest uploads‚Ä¶</p>
            <section class="space-y-2 animate-pulse">
              <section class="h-12 rounded-xl bg-slate-800/60"></section>
              <section class="h-12 rounded-xl bg-slate-800/60"></section>
            </section>
          </section>
        </section>
      </section>
    </section>

    <!-- RIGHT: NEWS + FAN VOTES + CONTACT -->
    <section class="space-y-4 md:pl-1">

      <!-- NEWS / RSS -->
      <section id="news" class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-5 space-y-3 mobile-full-width md:mobile-full-width-none">
        <header>
          <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
            Scene headlines
          </h2>
          <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
            Curated EDM news feed that mirrors the direction of today‚Äôs chart: labels, festivals, interviews and releases.
          </p>
        </header>

        <section id="news-list" class="space-y-3 max-h-[320px] overflow-y-auto"
                 aria-live="polite" aria-busy="false">
          <section id="news-skeleton" class="space-y-2">
            <section class="h-12 rounded-xl bg-slate-800/60 animate-pulse"></section>
            <section class="h-12 rounded-xl bg-slate-800/60 animate-pulse"></section>
          </section>
        </section>

        <!-- In-article ad -->
        <section class="mt-3 rounded-2xl bg-slate-950/90 border border-slate-800 p-2">
          <ins class="adsbygoogle"
               style="display:block;width:100%;min-height:80px"
               data-ad-client="ca-pub-4201977277980522"
               data-ad-slot="2345678901"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>
            window.addEventListener("load", function () {
              try {
                (adsbygoogle = window.adsbygoogle || []).push({});
              } catch (e) {}
            });
          </script>
        </section>
      </section>

      <!-- FAN VOTES -->
      <section id="fan" class="rounded-3xl bg-edm-glass border border-slate-800/80 backdrop-blur-2xl p-4 sm:p-5 space-y-3 mobile-full-width md:mobile-full-width-none">
        <header class="flex items-center justify-between gap-2">
          <section>
            <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
              Fan-voted favourites
            </h2>
            <p class="mt-1 text-xs sm:text-[13px] text-slate-300/90">
              Tap the heart on any track to add a vote. This list shows what EDM VERSEX visitors keep coming back to.
            </p>
          </section>
        </header>

        <section id="fan-list" class="mt-1 max-h-[260px] overflow-y-auto space-y-2 text-[11px]"
                 aria-live="polite" aria-busy="false">
        </section>
      </section>

      <!-- ABOUT + CONTACT -->
      <section id="about" class="rounded-3xl bg-edm-panel border border-slate-800 shadow-edm-soft p-4 sm:p-5 space-y-3 mobile-full-width md:mobile-full-width-none">
        <header>
          <h2 class="text-sm sm:text-base font-semibold tracking-[0.25em] uppercase text-emerald-400">
            About EDM VERSEX
          </h2>
        </header>
        <section class="space-y-2 text-sm sm:text-[15px] leading-relaxed text-slate-300/90">
          <p>
            EDM VERSEX is a daily rhythm check for electronic dance music. The page focuses on tracks and artists that
            live in the club space: house, trance, techno and hybrid sounds in between.
          </p>
          <p>
            Each day a new snapshot is taken from the SoundCloud ecosystem, ordered by real plays and fresh uploads.
            That data is woven together with headlines and community votes, so the experience stays both numerical and human.
          </p>
          <p>
            For labels, producers and promoters, this hub offers a place where new listeners discover tracks in context:
            directly next to news, fan favourites and the surrounding sound of the scene.
          </p>
        </section>
        <section class="mt-3 text-xs text-slate-300/90">
          <p class="font-semibold tracking-[0.22em] uppercase text-emerald-400 mb-1">Contact</p>
          <p>General questions, promos and partnerships: <a href="mailto:info@edmversex.com" class="underline">info@edmversex.com</a></p>
        </section>
      </section>
    </section>
  </section>
</main>

<!-- MINI PLAYER -->
<section id="mini-player" class="fixed inset-x-0 bottom-14 sm:bottom-16 z-30 px-4 transition-transform translate-y-full">
  <section class="mx-auto max-w-3xl rounded-2xl bg-slate-950/95 border border-slate-800/90 shadow-edm-soft overflow-hidden">
    <header class="flex items-center justify-between px-3 py-2 text-[11px] text-slate-200 bg-slate-900/80">
      <section class="flex items-center gap-2 min-w-0">
        <span class="inline-flex h-6 w-6 rounded-full bg-emerald-500/20 items-center justify-center">
          <span class="h-2 w-2 rounded-full bg-emerald-400 animate-pulse"></span>
        </span>
        <p id="mini-player-title" class="truncate">Now playing</p>
      </section>
      <button id="mini-player-close" type="button" class="text-slate-300 hover:text-emerald-400">
        Close
      </button>
    </header>
    <section class="bg-black aspect-[16/9]">
      <iframe id="mini-player-frame"
              title="EDM VERSEX player"
              width="100%" height="100%"
              scrolling="no"
              frameborder="no"
              allow="autoplay"
              src=""></iframe>
    </section>
  </section>
</section>

<!-- FOOTER BAR -->
<footer class="fixed bottom-0 left-0 right-0 z-40">
  <section class="mx-auto max-w-6xl px-4 pb-[env(safe-area-inset-bottom)]">
    <section class="rounded-2xl bg-slate-950/95 border border-slate-800/90 backdrop-blur-xl shadow-edm-soft px-3 py-2 flex flex-col gap-1 mobile-full-width">
      <section class="flex items-center justify-between text-[10px] text-slate-400">
        <p>¬© <span id="year"></span> EDM VERSEX ¬∑ Global EDM hub</p>
        <a href="#top" class="underline">Back to top</a>
      </section>
      <section class="flex items-center justify-between text-[11px]">
        <nav class="flex items-center gap-1.5">
          <a href="#top50" class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">üìà</span><span>Top 50</span>
          </a>
          <a href="#latest" class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">üÜï</span><span>Latest</span>
          </a>
          <a href="#fan" class="px-2 py-1 rounded-xl bg-slate-900/80 border border-slate-700/80 flex items-center gap-1">
            <span aria-hidden="true">‚ù§Ô∏è</span><span>Fan picks</span>
          </a>
        </nav>
        <a href="#about" class="text-[10px] underline">About & contact</a>
      </section>
    </section>
  </section>
</footer>

<noscript>
  <section class="mx-auto max-w-6xl mt-4 px-4">
    <section class="rounded-2xl bg-red-900/80 text-red-100 p-3 text-xs">
      JavaScript is disabled. Charts, latest tracks, news and voting features require JavaScript to be enabled.
    </section>
  </section>
</noscript>

<script>
  (function () {
    "use strict";

    const API_BASE = "https://edmversex.com/api";
    const ENDPOINTS = {
      snapshot: API_BASE + "/snapshot",
      topVoted: API_BASE + "/top-voted",
      vote: API_BASE + "/vote"
    };

    const statTrackCount = document.getElementById("stat-track-count");
    const statLastUpdated = document.getElementById("stat-last-updated");
    const statDominantGenre = document.getElementById("stat-dominant-genre");

    const top50Container = document.getElementById("top50-list");
    const top50Skeleton = document.getElementById("top50-skeleton");
    const latestContainer = document.getElementById("latest-list");
    const latestSkeleton = document.getElementById("latest-skeleton");
    const newsContainer = document.getElementById("news-list");
    const newsSkeleton = document.getElementById("news-skeleton");
    const fanContainer = document.getElementById("fan-list");

    const filterButtons = document.querySelectorAll(".genre-filter-btn");

    const miniPlayer = document.getElementById("mini-player");
    const miniFrame = document.getElementById("mini-player-frame");
    const miniTitle = document.getElementById("mini-player-title");
    const miniClose = document.getElementById("mini-player-close");

    let top50Data = [];
    let latestData = [];
    let newsData = [];
    let currentGenreFilter = "all";

    function setText(el, text) {
      if (el) el.textContent = String(text || "");
    }

    function formatNumber(n) {
      const num = typeof n === "number" ? n : Number(n || 0);
      if (Number.isNaN(num)) return "-";
      if (num >= 1_000_000) return (num / 1_000_000).toFixed(1) + "M";
      if (num >= 1_000) return (num / 1_000).toFixed(1) + "k";
      return num.toString();
    }

    function normalizeGenre(genre) {
      const g = String(genre || "").toLowerCase();
      if (g.includes("house")) return "house";
      if (g.includes("trance")) return "trance";
      if (g.includes("techno")) return "techno";
      if (g.includes("bass")) return "bass";
      return "other";
    }

    async function fetchJSON(url, options) {
      const res = await fetch(url, Object.assign({ cache: "no-store" }, options || {}));
      if (!res.ok) throw new Error("HTTP " + res.status);
      return res.json();
    }

    function renderStats(stats, meta) {
      if (!stats) return;
      setText(statTrackCount, stats.trackCount || 0);
      if (meta && meta.generatedAt) {
        try {
          const d = new Date(meta.generatedAt);
          setText(statLastUpdated, d.toLocaleString());
        } catch {
          setText(statLastUpdated, meta.generatedAt);
        }
      } else {
        setText(statLastUpdated, "‚Äì");
      }
      if (stats.dominantGenre) {
        setText(statDominantGenre, stats.dominantGenre.toUpperCase());
      } else {
        setText(statDominantGenre, "MIXED");
      }
    }

    function renderTop50() {
      if (!top50Container) return;
      top50Container.setAttribute("aria-busy", "true");
      if (top50Skeleton) top50Skeleton.style.display = "none";

      const html = top50Data.map(function (track) {
        const norm = normalizeGenre(track.genre);
        const isActive = currentGenreFilter === "all" || currentGenreFilter === norm;
        const containerClass = isActive
          ? "border-emerald-500/70 bg-slate-900/95"
          : "border-slate-800 bg-slate-950/80 opacity-80";

        const duration =
          typeof track.durationMs === "number"
            ? Math.round(track.durationMs / 1000 / 60) + " min"
            : "";

        return (
          '<article class="m-1 rounded-2xl border ' + containerClass +
          ' px-2.5 py-2 flex items-center gap-2 text-[11px] sm:text-[12px]">' +
          '  <section class="flex flex-col items-center justify-center w-7 shrink-0">' +
          '    <span class="text-xs font-semibold text-slate-200">#' + (track.rank || "?") + "</span>" +
          '    <span class="text-[9px] text-slate-500 mt-0.5">' + norm.toUpperCase() + "</span>" +
          "  </section>" +
          '  <section class="flex items-center gap-2 flex-1 min-w-0">' +
          (track.artwork
            ? '<img src="' + track.artwork + '" alt="" class="h-9 w-9 rounded-lg object-cover shrink-0" loading="lazy"/>'
            : '<div class="h-9 w-9 rounded-lg bg-slate-800/90 flex items-center justify-center text-[10px] shrink-0">EDM</div>'
          ) +
          '    <section class="flex-1 min-w-0">' +
          '      <p class="truncate text-slate-50 font-semibold">' + (track.title || "Untitled") + "</p>" +
          '      <p class="truncate text-slate-400">' + (track.artist || "Unknown artist") + "</p>" +
          '      <p class="text-[10px] text-slate-500 mt-0.5">' +
          '        üéß ' + formatNumber(track.plays || 0) + " ¬∑ " + duration +
          "      </p>" +
          "    </section>" +
          "  </section>" +
          '  <section class="flex flex-col items-end gap-1 text-[10px] shrink-0">' +
          '    <button type="button" class="inline-flex items-center justify-center px-2.5 py-1 rounded-full bg-emerald-500 text-slate-950 font-semibold play-btn" ' +
          '            data-play-url="' + (track.url || "") + '" data-track-title="' + (track.title || "") + '">' +
          "      ‚ñ∂ Play" +
          "    </button>" +
          '    <button type="button" class="inline-flex items-center justify-center px-2.5 py-1 rounded-full border border-slate-600 text-slate-200 vote-btn" ' +
          '            data-track-id="' + track.trackId + '" data-track-title="' + (track.title || "") + '"' +
          '            data-track-artist="' + (track.artist || "") + '" data-track-url="' + (track.url || "") + '"' +
          '            data-track-artwork="' + (track.artwork || "") + '">' +
          "      ‚ù§Ô∏è Vote" +
          "    </button>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      top50Container.innerHTML = html || '<p class="p-3 text-[11px] text-slate-400">No chart data available.</p>';
      top50Container.setAttribute("aria-busy", "false");
    }

    function renderLatest() {
      if (!latestContainer) return;
      latestContainer.setAttribute("aria-busy", "true");
      if (latestSkeleton) latestSkeleton.style.display = "none";

      const html = latestData.map(function (track) {
        const d = track.createdAt ? new Date(track.createdAt) : null;
        const dateLabel = d ? d.toLocaleDateString() : "";
        return (
          '<article class="m-1 rounded-2xl border border-slate-800 bg-slate-950/85 p-3 flex items-center gap-2 text-[11px] sm:text-[12px]">' +
          (track.artwork
            ? '<img src="' + track.artwork + '" alt="" class="h-9 w-9 rounded-lg object-cover shrink-0" loading="lazy"/>'
            : '<div class="h-9 w-9 rounded-lg bg-slate-800/90 flex items-center justify-center text-[10px] shrink-0">EDM</div>'
          ) +
          '  <section class="flex-1 min-w-0">' +
          '    <p class="truncate text-slate-50 font-semibold">' + (track.title || "Untitled") + "</p>" +
          '    <p class="truncate text-slate-400">' + (track.artist || "Unknown artist") + "</p>" +
          '    <p class="text-[10px] text-slate-500 mt-0.5">' + dateLabel + "</p>" +
          "  </section>" +
          '  <section class="flex flex-col items-end gap-1 text-[10px] shrink-0">' +
          '    <button type="button" class="inline-flex items-center justify-center px-2.5 py-1 rounded-full bg-slate-900/90 border border-slate-600 play-btn" ' +
          '            data-play-url="' + (track.url || "") + '" data-track-title="' + (track.title || "") + '">' +
          "      ‚ñ∂ Play" +
          "    </button>" +
          "  </section>" +
          "</article>"
        );
      }).join("");

      latestContainer.innerHTML = html || '<p class="p-3 text-[11px] text-slate-400">No recent uploads in this snapshot.</p>';
      latestContainer.setAttribute("aria-busy", "false");
    }

    function renderNews() {
      if (!newsContainer) return;
      newsContainer.setAttribute("aria-busy", "true");
      if (newsSkeleton) newsSkeleton.style.display = "none";

      const html = newsData.map(function (item) {
        const d = item.publishedAt ? new Date(item.publishedAt) : null;
        const dateLabel = d ? d.toLocaleDateString() : "";
        return (
          '<article class="rounded-2xl border border-slate-800 bg-slate-950/85 p-3 text-[11px] sm:text-[12px]">' +
          '  <a href="' + (item.link || "#") + '" target="_blank" rel="noopener noreferrer" class="block group">' +
          '    <p class="text-[10px] uppercase tracking-[0.22em] text-sky-400 mb-0.5">EDM news</p>' +
          '    <h3 class="font-semibold text-slate-50 group-hover:text-emerald-400 line-clamp-2">' +
          (item.title || "EDM headline") + "</h3>" +
          '    <p class="mt-1 text-slate-300/90 line-clamp-3">' + (item.summary || "") + "</p>" +
          '    <p class="mt-1 text-[10px] text-slate-500">' + dateLabel + "</p>" +
          "  </a>" +
          "</article>"
        );
      }).join("");

      newsContainer.innerHTML = html || '<p class="text-[11px] text-slate-400">No news articles available right now.</p>';
      newsContainer.setAttribute("aria-busy", "false");
    }

    function renderTopVoted(list) {
      if (!fanContainer) return;
      fanContainer.setAttribute("aria-busy", "true");

      const html = list.map(function (item, idx) {
        return (
          '<article class="rounded-2xl border border-slate-800 bg-slate-950/85 px-3 py-2 flex items-center gap-2">' +
          '  <span class="text-[11px] text-slate-400 w-4 text-right">' + (idx + 1) + ".</span>" +
          '  <section class="flex-1 min-w-0 text-[11px]">' +
          '    <p class="truncate text-slate-50 font-semibold">' + (item.title || "Untitled") + "</p>" +
          '    <p class="truncate text-slate-400">' + (item.artist || "Unknown artist") + "</p>" +
          "  </section>" +
          '  <section class="flex items-center gap-1 text-[10px] text-slate-300 shrink-0">' +
          '    <span>‚ù§Ô∏è ' + (item.votes || 0) + "</span>" +
          '    <a href="' + (item.url || "#") + '" target="_blank" rel="noopener noreferrer" class="underline">Open</a>' +
          "  </section>" +
          "</article>"
        );
      }).join("");

      fanContainer.innerHTML = html || '<p class="text-[11px] text-slate-400">No fan votes yet. Be the first to vote a track in.</p>';
      fanContainer.setAttribute("aria-busy", "false");
    }

    function openPlayer(url, title) {
      if (!url || !miniPlayer || !miniFrame) return;
      const src =
        "https://w.soundcloud.com/player/?url=" +
        encodeURIComponent(url) +
        "&color=%2322c55e&auto_play=true&hide_related=true&show_comments=false&show_user=true&show_reposts=false&show_teaser=false&visual=true";

      miniFrame.src = src;
      if (miniTitle) {
        miniTitle.textContent = title || "Now playing";
      }
      miniPlayer.style.transform = "translateY(0)";
    }

    function closePlayer() {
      if (!miniPlayer || !miniFrame) return;
      miniPlayer.style.transform = "translateY(100%)";
      miniFrame.src = "";
    }

    function attachEvents() {
      if (miniClose) {
        miniClose.addEventListener("click", closePlayer);
      }

      document.addEventListener("click", function (evt) {
        const playBtn = evt.target.closest(".play-btn");
        if (playBtn) {
          const url = playBtn.getAttribute("data-play-url");
          const title = playBtn.getAttribute("data-track-title");
          openPlayer(url, title);
          return;
        }

        const voteBtn = evt.target.closest(".vote-btn");
        if (voteBtn) {
          const trackId = voteBtn.getAttribute("data-track-id");
          const title = voteBtn.getAttribute("data-track-title");
          const artist = voteBtn.getAttribute("data-track-artist");
          const url = voteBtn.getAttribute("data-track-url");
          const artwork = voteBtn.getAttribute("data-track-artwork");
          submitVote(voteBtn, { trackId, title, artist, url, artwork });
        }
      });

      filterButtons.forEach(function (btn) {
        btn.addEventListener("click", function () {
          const filter = btn.getAttribute("data-genre-filter") || "all";
          currentGenreFilter = filter;

          filterButtons.forEach(function (b) {
            b.classList.remove("bg-emerald-500", "text-slate-950");
            b.classList.add("bg-slate-950/80", "border-slate-700/80", "text-slate-100");
          });
          btn.classList.remove("bg-slate-950/80", "text-slate-100");
          btn.classList.add("bg-emerald-500", "text-slate-950");

          renderTop50();
        });
      });
    }

    async function submitVote(buttonEl, payload) {
      if (!payload.trackId) return;
      if (buttonEl) {
        buttonEl.disabled = true;
        buttonEl.textContent = "‚ù§Ô∏è Voted";
      }

      try {
        await fetchJSON(ENDPOINTS.vote, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const list = await fetchJSON(ENDPOINTS.topVoted);
        renderTopVoted(list);
      } catch (err) {
        console.error("Vote error", err);
        if (buttonEl) {
          buttonEl.disabled = false;
          buttonEl.textContent = "‚ù§Ô∏è Vote";
        }
      }
    }

    async function loadSnapshot() {
      try {
        const data = await fetchJSON(ENDPOINTS.snapshot);
        if (data.top50 && Array.isArray(data.top50)) {
          top50Data = data.top50;
          renderTop50();
        }
        if (data.latest && Array.isArray(data.latest)) {
          latestData = data.latest;
          renderLatest();
        }
        if (data.news && Array.isArray(data.news)) {
          newsData = data.news;
          renderNews();
        }
        renderStats(data.stats, data.meta);
      } catch (err) {
        console.error("Snapshot error", err);
        if (top50Container) {
          top50Container.innerHTML = '<p class="p-3 text-[11px] text-red-300">Unable to load SoundCloud data right now. The previous daily snapshot will show again once available.</p>';
        }
      }
    }

    async function loadTopVoted() {
      try {
        const list = await fetchJSON(ENDPOINTS.topVoted);
        renderTopVoted(list);
      } catch (err) {
        console.error("Top voted error", err);
      }
    }

    function initYear() {
      const y = document.getElementById("year");
      if (y) y.textContent = new Date().getFullYear();
    }

    function initWaves() {
      const canvas = document.getElementById("bg-waves");
      if (!canvas) return;
      const ctx = canvas.getContext("2d");
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener("resize", resize);

      let t = 0;
      function draw() {
        if (!ctx) return;
        const w = canvas.width;
        const h = canvas.height;
        ctx.clearRect(0, 0, w, h);
        ctx.lineWidth = 1.2;

        const layers = [
          { color: "rgba(34,197,94,0.45)", amp: 30, speed: 0.0018 },
          { color: "rgba(56,189,248,0.40)", amp: 42, speed: 0.0014 },
          { color: "rgba(244,114,182,0.35)", amp: 54, speed: 0.0011 }
        ];

        layers.forEach(function (g, i) {
          ctx.beginPath();
          ctx.strokeStyle = g.color;
          const yBase = h * (0.3 + 0.15 * i);
          for (let x = 0; x <= w; x += 8) {
            const y =
              yBase +
              Math.sin(x * 0.012 + t * g.speed * 360) * g.amp *
              Math.cos(t * g.speed * 140 + i);
            if (x === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();
        });

        t++;
        requestAnimationFrame(draw);
      }
      draw();
    }

    initYear();
    initWaves();
    attachEvents();
    loadSnapshot();
    loadTopVoted();
  })();
</script>

</body>
</html>
